<div class="container mt-4 d-none d-md-block">
  <div class="col-12 mb-3">
    <div class="button-group">
      <div class="row">
        <div class="col">
          <h3 *ngIf="new">Kreiranje naloga</h3>
          <h3 *ngIf="!new">Informacije o nalogu</h3>
          <span>Status: </span
          ><span
            [ngClass]="{
              statusNovi: workOrder.status == 'Novi',
              statusURadu: workOrder.status == 'U radu',
              statusZatvoren: workOrder.status == 'Zatvoren'
            }"
            >{{ workOrder.status }}</span
          >
        </div>
        <div class="col" style="float: right">
          <button
            class="btn btn-primary btn-edit"
            [disabled]="workOrder.status == 'Zatvoren'"
            *ngIf="!new"
            (click)="closeWorkOrder()"
          >
            <i class="fa fa-check"></i> Zatvori radni nalog
          </button>
          <button
            class="btn btn-primary btn-add mr-2"
            [disabled]="workOrder.status == 'Zatvoren'"
            *ngIf="!new"
            (click)="updateWorkOrder()"
          >
            <i class="fa fa-save mr-2"></i>Sačuvaj radni nalog
          </button>

          <button
            class="btn btn-primary btn-add mr-2"
            *ngIf="new"
            (click)="addWorkOrder(infoWorkOrderForm)"
          >
            <i class="fa fa-plus mr-2"></i>Kreiraj
          </button>
        </div>
      </div>
    </div>
  </div>
  <!--header info-->
  <div class="header-info">
    <form #infoWorkOrderForm="ngForm">
      <table class="table header-table">
        <tr>
          <td class="left-col-header">
            <i class="fa fa-file mr-2"></i>Operacija:
          </td>
          <td class="right-col-header">
            <select
              [(ngModel)]="workOrder.operationId"
              class="form-control"
              id=""
              (change)="getOperation()"
              name="operation"
              #operation="ngModel"
              required
            >
              <option value="{{ op.id }}" *ngFor="let op of operations">
                {{ op.name }}
              </option>
            </select>
            <div
              *ngIf="operation.invalid && clickAddWorkOrder"
              style="color: red; font-weight: normal"
            >
              Izaberite operaciju.
            </div>
          </td>
          <td class="left-col-header">
            <i class="fa fa-database mr-2"></i>Tabla:
          </td>
          <td class="right-col-header">
            <select
              name="selectedTable"
              class="form-control"
              id=""
              [(ngModel)]="workOrder.tableId"
              (change)="getCulture()"
              #table="ngModel"
              required
            >
              <option value="{{ table.dbId }}" *ngFor="let table of fields">
                {{ table.Name }}
              </option>
            </select>
            <div
              *ngIf="table.invalid && clickAddWorkOrder"
              style="color: red; font-weight: normal"
            >
              Izaberite tablu.
            </div>
          </td>
        </tr>
        <tr>
          <td class="left-col-header">
            <i class="fa fa-calendar mr-2"></i>Datum:
          </td>
          <td class="right-col-header">
            <div class="input-group mb-3">
              <input
                [(ngModel)]="workOrder.date"
                name="poc"
                ngbDatepicker
                #od="ngbDatepicker"
                (click)="od.toggle()"
                class="form-control"
                #dateFrom="ngModel"
                required
              />
              <div class="input-group-append">
                <button
                  class="btn btn-outline-secondary calendar"
                  (click)="od.toggle()"
                  type="button"
                ></button>
              </div>
            </div>

            <div
              *ngIf="dateFrom == null && clickAddWorkOrder"
              style="color: red; font-weight: normal"
            >
              Izaberite datum.
            </div>
          </td>
          <td class="left-col-header">
            <i class="fa fa-user mr-2"></i>Odgovorna osoba:
          </td>
          <td class="right-col-header">
            <form>
              <mat-form-field class="inputAuto">
                <input
                  type="text"
                  matInput
                  [formControl]="nameFC"
                  [matAutocomplete]="auto"
                  #search
                  style="width: 100%"
                  required
                />

                <mat-autocomplete
                  #auto="matAutocomplete"
                  [displayWith]="displayFn"
                >
                  <mat-option
                    *ngFor="
                      let emp of allEmployees | SearchEmployees: search.value
                    "
                    [value]="emp"
                  >
                    {{ emp.name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <div
                *ngIf="nameFC.valid == false && clickAddWorkOrder"
                style="color: red; font-weight: normal"
              >
                Izaberite odgovornu osobu.
              </div>
            </form>
          </td>
        </tr>
        <tr>
          <td class="left-col-header"><i class="fa fa-cubes"></i> Kultura:</td>
          <td class="right-col-header">
            <select
              name="culture"
              [(ngModel)]="workOrder.cropId"
              class="form-control"
              id=""
              (change)="getArea()"
              #culture="ngModel"
              required
            >
              <option value="{{ crop.id }}" *ngFor="let crop of crops">
                {{ crop.Name.split(",")[1] }}
              </option>
            </select>
            <div
              *ngIf="culture.invalid && clickAddWorkOrder"
              style="color: red; font-weight: normal"
            >
              Izaberite kulturu.
            </div>
          </td>
          <td class="left-col-header">
            <i class="fa fa-tasks mr-2"></i>Godina:
          </td>
          <td class="right-col-header">
            <select
              name="year"
              [(ngModel)]="workOrder.year"
              id=""
              class="form-control"
              *ngIf="!new; else elseBlockYear"
              (change)="getCulture()"
            >
              <option value="2020">2020</option>
              <option value="2019">2019</option>
            </select>
            <ng-template #elseBlockYear>
              <select
                name="selectedYear"
                [(ngModel)]="selectedYear"
                id=""
                class="form-control"
                (change)="getCulture()"
                #year="ngModel"
                required
              >
                <option value="2020">2020</option>
                <option value="2019">2019</option>
              </select>
              <div
                *ngIf="year.invalid && clickAddWorkOrder"
                style="color: red; font-weight: normal"
              >
                Izaberite godinu.
              </div>
            </ng-template>
          </td>
        </tr>
        <tr>
          <td class="left-col-header"><i class="fa fa-clone"></i> Površina:</td>
          <td class="right-col-header">
            <div class="input-group mb-3">
              <input
                type="text"
                name="area"
                [(ngModel)]="workOrder.area"
                id=""
                class="form-control"
                #area="ngModel"
                required
              />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">ha</span>
              </div>
            </div>

            <div
              *ngIf="area.invalid && clickAddWorkOrder"
              style="color: red; font-weight: normal"
            >
              Unesite površinu.
            </div>
          </td>
          <td class="left-col-header" >
            <span *ngIf="!new"> <i class="fa fa-flag mr-2"></i>Obrađeno: </span>
          </td>
          <td class="right-col-header" >
            <div class="input-group mb-3" *ngIf="!new">
              <input
                type="text"
                name="treated"
                [(ngModel)]="workOrder.treated"
                id=""
                class="form-control"
              />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">ha</span>
              </div>
            </div>
            <div
              *ngIf="validWoInfo == false && clickCloseWorkOrder"
              style="color: red; font-weight: normal"
            >
              Unesite površinu.
            </div>
          </td>
        </tr>
      </table>
    </form>
  </div>
  <!--workers/machines-->
  <div class="machines mt-4">
    <button
      class="btn btn-primary collapsing-button shadow-none"
      (click)="expandMachines()"
      type="button"
      data-toggle="collapse"
      data-target="#collapseExampleMachines"
      aria-expanded="false"
      aria-controls="collapseExampleMachines"
    >
      <i class="fa fa-user mr-2"></i>
      <i class="fa fa-truck mr-2"></i>
      Radnici/Mašine<i
        *ngIf="!machines"
        class="fa fa-arrow-down mr-2 mt-1 arrows"
        (click)="expandMachines()"
        data-toggle="collapse"
        data-target="#collapseExampleMachines"
        aria-expanded="false"
        aria-controls="collapseExampleMachines"
      ></i
      ><i
        *ngIf="machines"
        class="fa fa-arrow-up mr-2 mt-1 arrows"
        (click)="expandMachines()"
        data-toggle="collapse"
        data-target="#collapseExampleMachines"
        aria-expanded="false"
        aria-controls="collapseExampleMachines"
      ></i>
    </button>
    <div class="collapse" id="collapseExampleMachines">
      <div class="card card-body collapse-card">
        <form #wowForm="ngForm">
          <table class="table table-input">
            <thead>
              <th>Radnik*</th>
              <th>Operacija*</th>
              <th>Mašina</th>
              <th>Priključna mašina</th>
              <th style="text-align: right !important" *ngIf="!new">Dodatno</th>
              <th style="text-align: right !important">Dodaj</th>
              <th
                style="text-align: right !important"
                *ngIf="wows.length > 0 || workOrder.workers.length > 0"
              >
                Obriši
              </th>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div class="form-group">
                    <select
                      [(ngModel)]="selectedWorker"
                      name="selectedMachineWorker"
                      id=""
                      class="form-control"
                      #worker="ngModel"
                      required
                    >
                      <option
                        value="{{ emp.userId }}"
                        *ngFor="let emp of allEmployees"
                      >
                        {{ emp.name }}
                      </option>
                    </select>
                    <div
                      *ngIf="worker.invalid && clickAddWorkerMachine"
                      style="color: red"
                    >
                      Izaberite radnika.
                    </div>
                  </div>
                </td>
                <td>
                  <div class="form-group">
                    <select
                      name="selectedOperation"
                      id=""
                      [(ngModel)]="selectedOperation"
                      class="form-control"
                      #operation="ngModel"
                      required
                    >
                      <option value="{{ op.id }}" *ngFor="let op of operations">
                        {{ op.name }}
                      </option>
                    </select>
                    <div
                      *ngIf="operation.invalid && clickAddWorkerMachine"
                      style="color: red"
                    >
                      Izaberite operaciju.
                    </div>
                  </div>
                </td>
                <td>
                  <div class="form-group">
                    <select
                      [(ngModel)]="selectedMachine"
                      name="selectedMachine"
                      id=""
                      class="form-control"
                      #machine="ngModel"
                      required
                    >
                      <option
                        value="{{ dev.id }}"
                        *ngFor="let dev of devicesPropulsion"
                      >
                        {{ dev.name }}
                      </option>
                    </select>
                    <div
                      *ngIf="machine.invalid && clickAddWorkerMachine"
                      style="color: red"
                    >
                      Izaberite mašinu.
                    </div>
                  </div>
                </td>
                <td>
                  <div class="form-group">
                    <select
                      [(ngModel)]="selectedCouplingMachine"
                      name="selectedCouplingMachine"
                      id=""
                      class="form-control"
                      #couplingMachine="ngModel"
                      required
                    >
                      <option
                        value="{{ dev.id }}"
                        *ngFor="let dev of devicesCoupling"
                      >
                        {{ dev.name }}
                      </option>
                    </select>
                    <div
                      *ngIf="couplingMachine.invalid && clickAddWorkerMachine"
                      style="color: red"
                    >
                      Izaberite priključnu mašinu.
                    </div>
                  </div>
                </td>
                <td  *ngIf="!new" >
                  <div class="form-group">
                    <button
                      class="btn btn-primary btn-add mr-2"
                      data-toggle="modal"
                      data-target="#workerMachineModal"
                      (click)="addDetailWow()"
                      
                    >
                      <i class="fa fa-ellipsis-v"></i>
                    </button>
                  </div>
                </td>
                <td>
                  <div *ngIf="new" class="form-group">
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="addWorkerAndMachine(wowForm.valid)"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-plus"></i>
                    </button>
                  </div>
                  <div *ngIf="!new" class="form-group">
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="addNewWorkerAndMachine()"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-plus"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <!--editable table worker/machine new wo-->
              <ng-container *ngIf="new; else elseBlockMachineState">
                <span *ngIf="wows.length == 0"
                  >Nema dodatih radnika i mašina, dodajte klikom na dugme </span
                ><i class="fa fa-plus" *ngIf="wows.length == 0"></i>
                <tr *ngFor="let wow of wows">
                  <td>
                    <select
                      [(ngModel)]="wow.user.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.user.id }}"
                      id=""
                      class="form-control"
                    >
                      <option
                        value="{{ emp.userId }}"
                        *ngFor="let emp of allEmployees"
                      >
                        {{ emp.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <select
                      [(ngModel)]="wow.operation.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.operation.id }}"
                      id=""
                      class="form-control"
                    >
                      <option value="{{ op.id }}" *ngFor="let op of operations">
                        {{ op.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <select
                      [(ngModel)]="wow.machine.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.machine.id }}"
                      id=""
                      class="form-control"
                    >
                      <option
                        value="{{ dev.id }}"
                        *ngFor="let dev of devicesPropulsion"
                      >
                        {{ dev.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <select
                      [(ngModel)]="wow.connectingMachine.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.machine.id }}"
                      id=""
                      class="form-control"
                    >
                      <option
                        value="{{ dev.id }}"
                        *ngFor="let dev of devicesCoupling"
                      >
                        {{ dev.name }}
                      </option>
                    </select>
                  </td>
                  <!--
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-add mr-2"
                        data-toggle="modal"
                        data-target="#workerMachineModal"
                        (click)="editWorkerAndMachine(wow)"
                      >
                        <i class="fa fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </td>
                  -->
                  <td>
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="editExistingWorkerAndMachine(wow)"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-check"></i>
                    </button>
                  </td>
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-delete mr-2"
                        (click)="deleteWorkOrderWorker(wow)"
                      >
                        <i class="fa fa-minus"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-container>
              <!--editable table worker/machine existing wo-->
              <ng-template #elseBlockMachineState>
                <span *ngIf="workOrder.workers.length == 0"
                  >Nema dodatih radnika i mašina, dodajte klikom na dugme </span
                ><i
                  class="fa fa-plus"
                  *ngIf="workOrder.workers.length == 0"
                ></i>
                <tr *ngFor="let wow of workOrder.workers">
                  <td>
                    <select
                      [(ngModel)]="wow.user.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.user.id }}"
                      id=""
                      class="form-control"
                    >
                      <option
                        value="{{ emp.userId }}"
                        *ngFor="let emp of allEmployees"
                      >
                        {{ emp.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <select
                      [(ngModel)]="wow.operation.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.operation.id }}"
                      id=""
                      class="form-control"
                    >
                      <option value="{{ op.id }}" *ngFor="let op of operations">
                        {{ op.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <select
                      [(ngModel)]="wow.machine.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.machine.id }}"
                      id=""
                      class="form-control"
                    >
                      <option
                        value="{{ dev.id }}"
                        *ngFor="let dev of devicesPropulsion"
                      >
                        {{ dev.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <select
                      [(ngModel)]="wow.connectingMachine.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ wow.machine.id }}"
                      id=""
                      class="form-control"
                    >
                      <option
                        value="{{ dev.id }}"
                        *ngFor="let dev of devicesCoupling"
                      >
                        {{ dev.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-add mr-2"
                        data-toggle="modal"
                        data-target="#workerMachineModal"
                        (click)="editWorkerAndMachine(wow)"
                        id="{{ wow.id }}"
                      >
                        <i class="fa fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </td>
                  <td>
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="updateWow(wow)"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-check"></i>
                    </button>
                  </td>
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-delete mr-2"
                        (click)="deleteExistingWorkOrderWorker(wow.id)"
                        [disabled]="workOrder.status == 'Zatvoren'"
                      >
                        <i class="fa fa-minus"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </tbody>
          </table>
        </form>
      </div>
    </div>
  </div>
  <!--materials-->
  <div class="machines mt-4">
    <button
      class="btn btn-primary collapsing-button shadow-none"
      (click)="expandMaterials()"
      type="button"
      data-toggle="collapse"
      data-target="#collapseExampleMaterials"
      aria-expanded="false"
      aria-controls="collapseExampleMachines"
    >
      <i class="fa fa-leaf mr-2"></i>Materijali<i
        *ngIf="!materials"
        class="fa fa-arrow-down mr-2 mt-1 arrows"
        (click)="expandMaterials()"
        data-toggle="collapse"
        data-target="#collapseExampleMaterials"
        aria-expanded="false"
        aria-controls="collapseExampleMachines"
      ></i
      ><i
        *ngIf="materials"
        class="fa fa-arrow-up mr-2 mt-1 arrows"
        (click)="expandMaterials()"
        data-toggle="collapse"
        data-target="#collapseExampleMaterials"
        aria-expanded="false"
        aria-controls="collapseExampleMachines"
      ></i>
    </button>
    <div class="collapse" id="collapseExampleMaterials">
      <div class="card card-body collapse-card">
        <form #materialForm="ngForm">
          <table class="table table-input">
            <thead>
              <th>Materijal*</th>
              <th style="width: 150px">Planirana količina*</th>
              <th style="width: 180px">Planirana količina / ha*</th>
              <th style="text-align: right !important" *ngIf="!new">Dodatno</th>
              <th style="text-align: right !important">Dodaj</th>
              <th
                style="text-align: right !important"
                *ngIf="woMaterials.length > 0 || workOrder.materials.length > 0"
              >
                Obriši
              </th>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div class="form-group">
                    <select
                      [(ngModel)]="selectedMaterial"
                      name="selectedMaterial"
                      id=""
                      class="form-control"
                      (change)="getUnitOfMaterial(selectedMaterial)"
                      #name="ngModel"
                      required
                    >
                      <option
                        value="{{ sub.id }}"
                        *ngFor="let sub of substances"
                      >
                        {{ sub.name }}
                      </option>
                    </select>
                    <div
                      *ngIf="name.invalid && clickAddMaterial"
                      style="color: red"
                    >
                      Izaberite materijal.
                    </div>
                  </div>
                </td>
                <td>
                  <div class="form-group">
                    <div class="input-group mb-3">
                      <input
                        [(ngModel)]="quantityEntered"
                        type="number"
                        name="quantity"
                        id=""
                        class="form-control"
                        #quantity="ngModel"
                        required
                      />
                      <div class="input-group-append">
                        <span class="input-group-text" id="basic-addon2">{{
                          unit
                        }}</span>
                      </div>
                      <div
                        *ngIf="quantity.invalid && clickAddMaterial"
                        style="color: red"
                      >
                        Unesite količinu.
                      </div>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="form-group">
                    <div class="input-group mb-3">
                      <input
                        *ngIf="new; else elseBlockQuantity"
                        [(ngModel)]="quantityEntered / crop.Area"
                        type="number"
                        name="quantityPerHectar"
                        id=""
                        class="form-control"
                        disabled
                      />
                      <div class="input-group-append">
                        <span class="input-group-text" id="basic-addon2"
                          >{{ unit }}/ha</span
                        >
                      </div>
                      <ng-template #elseBlockQuantity>
                        <input
                          [(ngModel)]="quantityEntered / workOrder.area"
                          type="number"
                          name="quantityPerHectar"
                          id=""
                          class="form-control"
                          disabled
                        />
                      </ng-template>
                    </div>
                  </div>
                </td>
                <td *ngIf="!new">
                  <div class="form-group">
                    <button
                      class="btn btn-primary btn-add mr-2"
                      data-toggle="modal"
                      data-target="#materialModal"
                      (click)="addDetailMaterial()"
                    >
                      <i class="fa fa-ellipsis-v"></i>
                    </button>
                  </div>
                </td>
                <td>
                  <div *ngIf="new" class="form-group">
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="addMaterial(materialForm.valid)"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-plus"></i>
                    </button>
                  </div>
                  <div *ngIf="!new" class="form-group">
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="addNewMaterial()"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-plus"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <!--editable table materials new wo-->
              <ng-container *ngIf="new; else elseBlockSpentMaterial">
                <span *ngIf="woMaterials.length == 0"
                  >Nema dodatih materijala, dodajte klikom na dugme </span
                ><i class="fa fa-plus" *ngIf="woMaterials.length == 0"></i>
                <tr *ngFor="let material of woMaterials">
                  <td>
                    <select
                      [(ngModel)]="material.material.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ material.material.id }}"
                      id=""
                      class="form-control"
                      (change)="getUnitOfMaterial(material.material.id)"
                    >
                      <option
                        value="{{ sub.id }}"
                        *ngFor="let sub of substances"
                      >
                        {{ sub.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <div class="form-group">
                      <div class="input-group mb-3">
                        <input
                          [(ngModel)]="material.quantity"
                          [ngModelOptions]="{ standalone: true }"
                          type="number"
                          name="{{ material.quantity }}"
                          id=""
                          class="form-control"
                        />
                        <div class="input-group-append">
                          <span class="input-group-text" id="basic-addon2">{{
                            material.material.unit
                          }}</span>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="form-group">
                      <div class="input-group mb-3">
                        <input
                          [(ngModel)]="material.quantity / crop.Area"
                          [ngModelOptions]="{ standalone: true }"
                          type="number"
                          name="{{ material.quantity / crop.Area }}"
                          id=""
                          class="form-control"
                          disabled
                        />
                        <div class="input-group-append">
                          <span class="input-group-text" id="basic-addon2"
                            >{{ material.material.unit }}/ha</span
                          >
                        </div>
                      </div>
                    </div>
                  </td>
                  <!--
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-add mr-2"
                        data-toggle="modal"
                        data-target="#materialModal"
                        (click)="editMaterial(material)"
                      >
                        <i class="fa fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </td>
                  -->
                  <td>
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="editExistingMaterial(material)"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-check"></i>
                    </button>
                  </td>
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-delete mr-2"
                        (click)="deleteSpentMaterial(material)"
                      >
                        <i class="fa fa-minus"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-container>
              <!--editable table materials existing wo-->
              <ng-template #elseBlockSpentMaterial>
                <span *ngIf="workOrder.materials.length == 0"
                  >Nema dodatih materijala, dodajte klikom na dugme </span
                ><i
                  class="fa fa-plus"
                  *ngIf="workOrder.materials.length == 0"
                ></i>
                <tr *ngFor="let material of workOrder.materials">
                  <td>
                    <select
                      [(ngModel)]="material.material.id"
                      [ngModelOptions]="{ standalone: true }"
                      name="{{ material.material.id }}"
                      id=""
                      class="form-control"
                      (change)="getUnitOfMaterial(material.material.id)"
                    >
                      <option
                        value="{{ sub.id }}"
                        *ngFor="let sub of substances"
                      >
                        {{ sub.name }}
                      </option>
                    </select>
                  </td>
                  <td>
                    <div class="form-group">
                      <div class="input-group mb-3">
                        <input
                          [(ngModel)]="material.quantity"
                          [ngModelOptions]="{ standalone: true }"
                          type="number"
                          name="{{ material.quantity }}"
                          id=""
                          class="form-control"
                        />
                        <div class="input-group-append">
                          <span class="input-group-text" id="basic-addon2">{{
                            material.material.Unit
                          }}</span>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="form-group">
                      <div class="input-group mb-3">
                        <input
                          [(ngModel)]="material.quantityPerHectar"
                          [ngModelOptions]="{ standalone: true }"
                          type="number"
                          name="{{ material.quantityPerHectar }}"
                          id=""
                          class="form-control"
                          disabled
                        />
                        <div class="input-group-append">
                          <span class="input-group-text" id="basic-addon2"
                            >{{ material.material.Unit }}/ha</span
                          >
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-add mr-2"
                        data-toggle="modal"
                        data-target="#materialModal"
                        (click)="editMaterial(material)"
                        id="{{ material.id }}"
                      >
                        <i class="fa fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </td>
                  <td>
                    <button
                      class="btn btn-primary btn-add mr-2"
                      (click)="updateMaterial(material)"
                      [disabled]="workOrder.status == 'Zatvoren'"
                    >
                      <i class="fa fa-check"></i>
                    </button>
                  </td>
                  <td>
                    <div class="form-group">
                      <button
                        class="btn btn-primary btn-delete mr-2"
                        (click)="deleteExistingSpentMaterial(material.id)"
                        [disabled]="workOrder.status == 'Zatvoren'"
                      >
                        <i class="fa fa-minus"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </tbody>
          </table>
        </form>
      </div>
    </div>
  </div>
  <br />
  <div class="col" style="float: right">
    <button
      class="btn btn-primary btn-edit"
      [disabled]="workOrder.status == 'Zatvoren'"
      *ngIf="!new && machine && materials"
      (click)="closeWorkOrder()"
    >
      <i class="fa fa-check"></i> Zatvori radni nalog
    </button>
    <button
      class="btn btn-primary btn-add mr-2"
      [disabled]="workOrder.status == 'Zatvoren'"
      *ngIf="!new && machine && materials"
      (click)="updateWorkOrder()"
    >
      <i class="fa fa-save mr-2"></i>Sačuvaj radni nalog
    </button>

    <button
      class="btn btn-primary btn-add mr-2"
      *ngIf="new && machine && materials"
      (click)="addWorkOrder(infoWorkOrderForm)"
    >
      <i class="fa fa-plus mr-2"></i>Kreiraj
    </button>
  </div>
  <br />
</div>

<div class="container d-md-none">
  <div class="row" style="margin-top: 10px">
    <div class="col-8">
      <h3 *ngIf="new">Kreiranje naloga</h3>
      <h3 *ngIf="!new">Informacije o nalogu</h3>
      <span>Status: </span
      ><span
        [ngClass]="{
          statusNovi: workOrder.status == 'Novi',
          statusURadu: workOrder.status == 'U radu',
          statusZatvoren: workOrder.status == 'Zatvoren'
        }"
        >{{ workOrder.status }}</span
      >
    </div>
    <div class="col">
      <div class="btn-group-vertical" style="float: right">
        <button
          class="btn btn-primary btn-edit mb-2"
          [disabled]="workOrder.status == 'Zatvoren'"
          *ngIf="!new"
          (click)="closeWorkOrder()"
        >
          <i class="fa fa-window-close mr-2"></i>Zatvori
        </button>
        <button
          class="btn btn-primary btn-add mr-2"
          [disabled]="workOrder.status == 'Zatvoren'"
          *ngIf="!new"
          (click)="updateWorkOrder()"
        >
          <i class="fa fa-save mr-2"></i>Sačuvaj
        </button>
        <button
          class="btn btn-primary btn-add mr-2"
          *ngIf="new"
          (click)="addWorkOrder(workOrderInfoMobForm.valid)"
        >
          <i class="fa fa-plus mr-2"></i>Kreiraj
        </button>
      </div>
    </div>
  </div>
  <form #workOrderInfoMobForm="ngForm">
    <div class="row" style="margin-top: 10px">
      <div class="col-4">
        <i class="fa fa-file mr-2" style="vertical-align: middle"></i
        ><span style="vertical-align: bottom"> Operacija:</span>
      </div>
      <div class="col-8">
        <select
          name="operation"
          [(ngModel)]="workOrder.operationId"
          class="form-control"
          id=""
          (change)="getOperation()"
          #operation="ngModel"
          required
        >
          <option value="{{ op.id }}" *ngFor="let op of operations">
            {{ op.name }}
          </option>
        </select>
        <div *ngIf="operation.invalid && clickAddWorkOrder" style="color: red">
          Izaberite operaciju.
        </div>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-4">
        <i class="fa fa-database mr-2" style="vertical-align: middle"></i>Tabla:
      </div>
      <div class="col-4">
        <select
          name="selectedTable"
          [(ngModel)]="workOrder.tableId"
          (change)="getCulture()"
          class="form-control"
          id=""
          #table="ngModel"
          required
        >
          <option value="{{ table.id }}" *ngFor="let table of fields">
            {{ table.Name }}
          </option>
        </select>
        <div *ngIf="table.invalid && clickAddWorkOrder" style="color: red">
          Izaberite tablu.
        </div>
      </div>
    </div>
    <hr class="solid" />
    <div class="row mt-2">
      <div class="col-12">
        <i class="fa fa-calendar mr-2" style="vertical-align: middle"></i>Datum:
      </div>
      <div class="col-6">
        <label style="padding-top: 8px">Od</label
        ><input
          type="date"
          [(ngModel)]="workOrder.start"
          id="from"
          ngbDatepicker
          #from="ngbDatepicker"
          (click)="from.toggle()"
          class="form-control"
          name="dateFrom"
          #dateFrom="ngModel"
          required
        />
        <div *ngIf="dateFrom.invalid && clickAddWorkOrder" style="color: red">
          Izaberite datum.
        </div>
      </div>
      <div class="col-6">
        <label style="padding-top: 8px">Do</label>
        <input
          type="date"
          [(ngModel)]="workOrder.end"
          name=""
          class="form-control"
          id="to"
          ngbDatepicker
          #to="ngbDatepicker"
          (click)="to.toggle()"
          name="dateTo"
          #dateTo="ngModel"
          required
        />
        <div *ngIf="dateTo.invalid && clickAddWorkOrder" style="color: red">
          Izaberite datum.
        </div>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-6" style="margin-top: 5%">
        <i class="fa fa-user mr-2"></i>Odgovorna osoba:
      </div>
      <div class="col-6">
        <mat-form-field style="width: 100%">
          <input
            class="form-control inputAuto"
            type="text"
            aria-label="Number"
            matInput
            [matAutocomplete]="autophone"
            [formControl]="nameFC"
            #searchPhone
            required
          />

          <mat-autocomplete
            autoActiveFirstOption
            [displayWith]="displayFn"
            #autophone="matAutocomplete"
            class="inputAuto"
          >
            <mat-option
              *ngFor="
                let emp of allEmployees
                  | SearchEmployeesPhone: searchPhone.value
              "
              [value]="emp"
            >
              {{ emp.name }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
        <div *ngIf="nameFC.invalid && clickAddWorkOrder" style="color: red">
          Izaberite odgovornu osobu.
        </div>
      </div>
    </div>
    <hr class="solid" />
    <div class="row mt-2">
      <div class="col-6"><i class="fa fa-cubes"></i> Kultura:</div>
      <div class="col-6">
        <select
          name="culture"
          [(ngModel)]="workOrder.cropId"
          (change)="getArea()"
          class="form-control"
          id=""
          #culture="ngModel"
          required
        >
          <option value="{{ crop.id }}" *ngFor="let crop of crops">
            {{ crop.Name.split(",")[1] }}
          </option>
        </select>
        <div *ngIf="culture.invalid && clickAddWorkOrder" style="color: red">
          Izaberite kulturu.
        </div>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-6"><i class="fa fa-tasks mr-2"></i>Godina:</div>
      <div class="col-6">
        <select
          name="year"
          [(ngModel)]="selectedYear"
          (change)="getCulture()"
          id=""
          class="form-control"
          #year="ngModel"
          required
        >
          <option value="2020">2020</option>
          <option value="2019">2019</option>
        </select>
        <div *ngIf="year.invalid && clickAddWorkOrder" style="color: red">
          Izaberite godinu.
        </div>
      </div>
    </div>
    <hr class="solid" />
    <div class="row mt-2">
      <div class="col-6"><i class="fa fa-clone"></i> Površina:</div>
      <div class="col-6">
        <div class="input-group">
          <input
            type="text"
            name="area"
            [(ngModel)]="workOrder.area"
            id=""
            class="form-control"
            #area="ngModel"
            required
          />
          <div class="input-group-append">
            <span class="input-group-text" id="basic-addon2">ha</span>
          </div>
        </div>
        <div *ngIf="area.invalid && clickAddWorkOrder" style="color: red">
          Unesite površinu.
        </div>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-6">
        <span *ngIf="!new"><i class="fa fa-flag mr-2"></i>Obrađeno:</span>
      </div>
      <div class="col-6">
        <span *ngIf="!new">
          <div class="input-group">
            <input
              type="text"
              name="treated"
              [(ngModel)]="workOrder.treated"
              [ngClass]="!this.inputFill ? 'inputFillFalse' : null"
              id=""
              class="form-control"
            />
            <div class="input-group-append">
              <span class="input-group-text" id="basic-addon2">ha</span>
            </div>
          </div>
        </span>
      </div>
    </div>
  </form>
  <hr class="solid" />
  <div class="workers">
    <button
      class="btn btn-primary collapsing-button shadow-none"
      (click)="expandWorkers()"
      type="button"
      data-toggle="collapse"
      data-target="#collapseExample"
      aria-expanded="false"
      aria-controls="collapseExample"
    >
      <i class="fa fa-user mr-2"></i>Radnici<i
        *ngIf="!workers"
        class="fa fa-arrow-down mr-2 mt-1 arrows"
      ></i
      ><i *ngIf="workers" class="fa fa-arrow-up mr-2 mt-1 arrows"></i>
    </button>
    <div class="collapse" id="collapseExample">
      <div class="card card-body collapse-card">
        <div class="col-12">
          <button
            class="btn btn-primary"
            style="float: right; margin-top: 5px; background-color: #5c7495"
            data-toggle="modal"
            data-target="#exampleModal"
            (click)="addEmployee()"
          >
            <i class="fa fa-plus mr-2"></i>Novi radnik
          </button>
        </div>
        <br />
        <div
          class="card mb-3"
          *ngFor="let emp of employees; let i = index"
          style="border: 1px solid #5c7495; border-radius: 5px"
        >
          <div *ngIf="i == 0" id="rad"></div>
          <div class="card-body">
            <h5 class="card-title">{{ emp.name }}</h5>
            <ul class="list-group">
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-table" style="font-size: 20px"></i>
                <span style="padding-left: 2px"> Datum: {{ wor.date }}</span>
              </li>
              <li class="list-group-item list-group-item-info">
                <i
                  class="fa fa-suitcase"
                  style="font-size: 20px; vertical-align: bottom"
                ></i>
                <span style="padding-left: 2px; vertical-align: middle">
                  Operacija: {{ emp.operation }}
                </span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-clock-o" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Redovan rad: {{ wor.dayPeriod || 0 }}
                </span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-clock-o" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Noćni rad: {{ wor.nightWorkPeriod || 0 }}</span
                >
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-plus" style="font-size: 20px"></i>
                <span style="padding-left: 6px"
                  >Ukupan rad:
                  {{
                    wor.dayPeriod * 1 + worker.nightWorkPeriod * 1 || 0
                  }}h</span
                >
              </li>
            </ul>
          </div>
          <div class="card-footer" style="background-color: #acbacc3a">
            <button
              class="btn btn-secondary"
              style="float: right"
              data-toggle="modal"
              data-target="#exampleModal"
              (click)="editWorker(emp)"
            >
              <i class="fa fa-edit mr-2"></i>Izmeni
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="machines mt-4">
    <button
      class="btn btn-primary collapsing-button shadow-none"
      (click)="expandMachines()"
      type="button"
      data-toggle="collapse"
      data-target="#collapseExampleMachines"
      aria-expanded="false"
      aria-controls="collapseExampleMachines"
    >
      <i class="fa fa-truck mr-2"></i>Mašine<i
        *ngIf="!machines"
        class="fa fa-arrow-down mr-2 mt-1 arrows"
      ></i
      ><i *ngIf="machines" class="fa fa-arrow-up mr-2 mt-1 arrows"></i>
    </button>
    <div class="collapse" id="collapseExampleMachines">
      <div class="card card-body collapse-card">
        <div class="col-12">
          <button
            class="btn btn-primary"
            style="float: right; margin-top: 5px; background-color: #5c7495"
            data-toggle="modal"
            data-target="#machineModal"
            (click)="addDevice()"
          >
            <i class="fa fa-plus mr-2"></i>Nova mašina
          </button>
        </div>
        <br />
        <div
          class="card mb-3"
          *ngFor="let machine of woMachines; let i = index"
          style="border: 1px solid #5c7495; border-radius: 5px"
        >
          <div *ngIf="i == 0" id="mas"></div>
          <div class="card-body">
            <h5 class="card-title">{{ machine.machine.name }}</h5>
            <ul class="list-group">
              <li class="list-group-item list-group-item-info">
                <i
                  class="fa fa-suitcase"
                  style="font-size: 20px; vertical-align: bottom"
                ></i>
                <span style="padding-left: 2px; vertical-align: middle">
                  Radnik: {{ machine.user.name }}
                </span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-clock-o" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Početno stanje MČ:
                  {{ machine.initialState || 0 }} mh</span
                >
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-clock-o" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Krajnje stanje MČ: {{ machine.finalState || 0 }} mh</span
                >
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-plus" style="font-size: 20px"></i>
                <span style="padding-left: 6px"
                  >Utrošeni MČ:
                  {{
                    machine.initialState * 1 - machine.finalState * 1 || 0
                  }}h</span
                >
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-gas-pump" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Utrošak goriva: {{ machine.fuel || 0 }} l</span
                >
              </li>
            </ul>
          </div>
          <div class="card-footer" style="background-color: #acbacc3a">
            <button
              class="btn btn-secondary"
              style="float: right"
              data-toggle="modal"
              data-target="#machineModal"
              (click)="editMachine(machine)"
            >
              <i class="fa fa-edit mr-2"></i>Izmeni
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="machines mt-4">
    <button
      class="btn btn-primary collapsing-button shadow-none"
      (click)="expandMaterials()"
      type="button"
      data-toggle="collapse"
      data-target="#collapseExampleMaterials"
      aria-expanded="false"
      aria-controls="collapseExampleMachines"
    >
      <i class="fa fa-leaf mr-2"></i>Materijali<i
        *ngIf="!materials"
        class="fa fa-arrow-down mr-2 mt-1 arrows"
      ></i
      ><i *ngIf="materials" class="fa fa-arrow-up mr-2 mt-1 arrows"></i>
    </button>
    <div class="collapse" id="collapseExampleMaterials">
      <div class="card card-body collapse-card">
        <div class="col-12">
          <button
            class="btn btn-primary"
            style="float: right; margin-top: 5px; background-color: #5c7495"
            data-toggle="modal"
            data-target="#materialModalMob"
            (click)="addSubstance()"
          >
            <i class="fa fa-plus mr-2"></i>Novi materijal
          </button>
        </div>
        <br />
        <div
          class="card mb-3"
          *ngFor="let material of woMaterials; let i = index"
          style="border: 1px solid #5c7495; border-radius: 5px"
        >
          <div *ngIf="i == 0" id="mat"></div>
          <div class="card-body">
            <h5 class="card-title">{{ material.material.name }}</h5>
            <ul class="list-group">
              <li class="list-group-item list-group-item-info">
                <i
                  class="fa fa-calculator"
                  style="font-size: 20px; vertical-align: bottom"
                ></i>
                <span style="padding-left: 2px; vertical-align: middle">
                  Planirana količina po ha:
                  {{ (material.quantity / crop.Area).toFixed(2) }}
                  {{ material.material.unit }}/ha</span
                >
              </li>
              <li class="list-group-item list-group-item-info">
                <i
                  class="fa fa-sort-amount-asc"
                  style="font-size: 20px; vertical-align: bottom"
                ></i>
                <span style="padding-left: 3px; vertical-align: middle">
                  Planirana količina: {{ material.quantity }}
                  {{ material.material.unit }}</span
                >
              </li>
              <li class="list-group-item list-group-item-info">
                <i
                  class="fa fa-balance-scale"
                  style="font-size: 20px; vertical-align: bottom"
                ></i>
                <span style="padding-left: 3px; vertical-align: middle">
                  Jedinica mere: {{ material.material.unit }}</span
                >
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-plus" style="font-size: 20px"></i>
                <span style="padding-left: 6px"
                  >Utrošeno / ha: {{ material.spent / workOrder.area }}
                  {{ material.unit }}/ha</span
                >
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-gas-pump" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Utrošeno: {{ material.spent || 0 }} {{ material.unit }}</span
                >
              </li>
            </ul>
          </div>
          <div class="card-footer" style="background-color: #acbacc3a">
            <button
              class="btn btn-secondary"
              style="float: right"
              data-toggle="modal"
              data-target="#materialModal"
              (click)="editMaterial(material)"
            >
              <i class="fa fa-edit mr-2"></i>Izmeni
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="exampleModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          {{ modalHeader }}
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
          #closeButtonWorkerModal
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #workerModalForm="ngForm">
          <div class="form-group">
            <label for="imePrz">Ime i prezime</label>
            <select
              [(ngModel)]="selectedWorker"
              name="ime"
              id="imePrz"
              class="form-control"
              #worker="ngModel"
              required
            >
              <option
                value="{{ emp.userId }}&{{ emp.name }}"
                *ngFor="let emp of allEmployees"
              >
                {{ emp.name }}
              </option>
            </select>
            <div *ngIf="worker.invalid && clickAddWorker" style="color: red">
              Izaberite radnika.
            </div>
          </div>
          <div class="form-group">
            <label for="imePrz">Operacija</label>
            <select
              name="ope"
              [(ngModel)]="selectedOperation"
              class="form-control"
              id=""
              #operation="ngModel"
              required
            >
              <option value="{{ op.id }}" *ngFor="let op of operations">
                {{ op.name }}
              </option>
            </select>
            <div *ngIf="operation.invalid && clickAddWorker" style="color: red">
              Izaberite operaciju.
            </div>
          </div>
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Datum</label>
            <div class="input-group">
              <input
                [(ngModel)]="workOrder.date"
                name="dat"
                (click)="od.toggle()"
                class="form-control"
                id="od"
                placeholder="yyyy-mm-dd"
                ngbDatepicker
                #od="ngbDatepicker"
              />
              <div class="input-group-append">
                <button
                  class="btn btn-outline-secondary calendar"
                  (click)="od.toggle()"
                  type="button"
                ></button>
              </div>
            </div>
          </div>
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Redovan rad</label>
            <div class="input-group mb-3">
              <input
                [(ngModel)]="wow.dayPeriod"
                type="number"
                name="dayWP"
                class="form-control"
                id=""
              />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">h</span>
              </div>
            </div>
          </div>
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Noćni rad</label>
            <div class="input-group mb-3">
              <input
                [(ngModel)]="wow.nightPeriod"
                type="number"
                name="nightWP"
                class="form-control"
                id=""
              />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">h</span>
              </div>
            </div>
          </div>
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Ukupan rad</label>
            <div class="input-group mb-3">
              <input
                type="number"
                name="sumHours"
                class="form-control"
                id=""
                readonly
              />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">h</span>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-danger"
          data-dismiss="modal"
          style="background-color: #f68901"
        >
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button
          *ngIf="!editing"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="addWorker(workerModalForm.valid)"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button
          *ngIf="editing"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="editExistingWorker()"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Machine Modal -->
<div
  class="modal fade"
  id="machineModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          {{ headerMachine }}
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
          #closeButtonMachineModal
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #machineModalForm="ngForm">
          <div class="form-group">
            <label for="masina">Mašina</label>
            <select
              name="masina"
              id="masina"
              class="form-control"
              [(ngModel)]="selectedMachine"
              #machine="ngModel"
              required
            >
              <option
                value="{{ dev.id }}&{{ dev.Name }}"
                *ngFor="let dev of devices"
              >
                {{ dev.Name }}
              </option>
            </select>
            <div *ngIf="machine.invalid && clickAddMachine" style="color: red">
              Izaberite mašinu.
            </div>
          </div>
          <div class="form-group">
            <label for="rad">Radnik</label>
            <select
              name="rad"
              id="rad"
              class="form-control"
              [(ngModel)]="selectedWorkerForMachine"
              #machineWorker="ngModel"
              required
            >
              <option
                value="{{ emp.userId }}&{{ emp.name }}"
                *ngFor="let emp of allEmployees"
              >
                {{ emp.name }}
              </option>
            </select>
            <div
              *ngIf="machineWorker.invalid && clickAddMachine"
              style="color: red"
            >
              Izaberite radnika.
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-danger"
          data-dismiss="modal"
          style="background-color: #f68901"
        >
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button
          *ngIf="!editingMachine"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="addMachine(machineModalForm.valid)"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button
          *ngIf="editingMachine"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="editExistingMachine()"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
<!--Material modal mob-->
<div
  class="modal fade"
  id="materialModalMob"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          {{ headerMaterial }}
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
          #closeButtonMaterialModal
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #materialModalForm="ngForm">
          <div class="form-group">
            <label for="materijal">Materijal</label>
            <select
              id="materijal"
              class="form-control"
              name="materijal"
              [(ngModel)]="selectedMaterial"
              #material="ngModel"
              required
              (change)="getUnitOfMaterial()"
            >
              <option
                value="{{ sub.id }}&{{ sub.name }}"
                *ngFor="let sub of substances"
              >
                {{ sub.name }}
              </option>
            </select>
            <div
              *ngIf="material.invalid && clickAddMaterial"
              style="color: red"
            >
              Izaberite materijal.
            </div>
          </div>
          <div class="form-group">
            <label for="jm">Jedinica mere</label>
            <select
              name="jm"
              id="jm"
              class="form-control"
              [(ngModel)]="selectedMaterial"
              #matUnit="ngModel"
              required
            >
              <option value="kg">kg</option>
              <option value="t">t</option>
              <option value="l">l</option>
            </select>
            <div *ngIf="matUnit.invalid && clickAddMaterial" style="color: red">
              Izaberite jedinicu mere.
            </div>
          </div>
          <div class="form-group">
            <label for="quantity">Planirana količina</label>
            <div class="input-group mb-3">
              <input
                [(ngModel)]="quantityEntered"
                type="number"
                name="quantity"
                id="quantity"
                class="form-control"
                #quantity="ngModel"
                required
              />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">{{
                  selectedUnit
                }}</span>
              </div>
            </div>
            <div
              *ngIf="quantity.invalid && clickAddMaterial"
              style="color: red"
            >
              Unesite količinu.
            </div>
          </div>
          <div class="form-group">
            <label for="quantityPerHectar">Planirana količina / ha</label>
            <div class="input-group mb-3">
              <input
                [(ngModel)]="quantityEntered / crop.area"
                type="number"
                name="quantityPerHectar"
                id="quantityPerHectar"
                class="form-control"
                readonly
              />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2"
                  >{{ selectedUnit }}/ha</span
                >
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-danger"
          data-dismiss="modal"
          style="background-color: #f68901"
        >
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button
          *ngIf="!editingMaterial"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="addMaterial(materialModalForm.valid)"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button
          *ngIf="editingMaterial"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="editExistingMaterial()"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Modal Worker/Machine -->
<div
  class="modal fade"
  id="workerMachineModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">
          <i class="fa fa-sticky-note-o"></i> Učinci radnika i mašina
        </h4>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
          #closeButtonWowModal
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #workerModalForm="ngForm">
          <div class="row">
            <div class="col">
              <h5><i class="fa fa-user mr-2"></i> Radnik</h5>
              <h6 *ngIf="wow.id != undefined">{{ wow.user.name }}</h6>
              <hr class="solid" />
              <div class="form-group">
                <label for="imePrz">Redovan rad</label>
                <div class="input-group mb-3">
                  <input
                    [(ngModel)]="wow.dayPeriod"
                    type="number"
                    name="dayWP"
                    class="form-control"
                    id="dayWP"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validDayPeriod == false && clickAddWowDetail) || (validDayPeriod == false && clickAddNewWow)"
                  style="color: red"
                >
                Maksimalan broj sati je 24.
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Noćni rad</label>
                <div class="input-group mb-3">
                  <input
                    [(ngModel)]="wow.nightPeriod"
                    type="number"
                    name="nightWP"
                    class="form-control"
                    id=""
                    max="24"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validNightPeriod == false && clickAddWowDetail) || (validNightPeriod == false && clickAddNewWow)"
                  style="color: red"
                >
                Maksimalan broj sati je 24.
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Ukupan rad</label>
                <div class="input-group mb-3">
                  <input
                    [(ngModel)]="wow.dayPeriod + wow.nightPeriod"
                    type="number"
                    name="sumHours"
                    class="form-control"
                    id=""
                    readonly
                    max="24"
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validWorkPeriod == false && clickAddWowDetail) || (validWorkPeriod == false && clickAddNewWow)"
                  style="color: red"
                >
                Maksimalan broj sati je 24.
                </div>
              </div>
            </div>
            <div class="col">
              <h5><i class="fa fa-truck mr-2"></i> Mašina</h5>
              <h6>{{ wow.machine.name }}</h6>
              <hr class="solid" />
              <div class="form-group">
                <label for="imePrz">Početno stanje MČ</label>
                <div class="input-group mb-3">
                  <input
                    [(ngModel)]="wow.initialState"
                    type="number"
                    name="initialState"
                    class="form-control"
                    id=""
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Krajnje stanje MČ</label>
                <div class="input-group mb-3">
                  <input
                    [(ngModel)]="wow.finalState"
                    type="number"
                    name="finalState"
                    class="form-control"
                    id=""
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validFinalState == false && clickAddWowDetail) || (validFinalState == false && clickAddNewWow)"
                  style="color: red"
                >
                Krajnje stanje ne može biti manje od početnog.
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Utrošeno MČ</label>
                <div class="input-group mb-3">
                  <input
                    [(ngModel)]="wow.finalState - wow.initialState"
                    type="number"
                    name="sumState"
                    class="form-control"
                    id=""
                    readonly
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Utrošeno goriva</label>
                <div class="input-group mb-3">
                  <input
                    [(ngModel)]="wow.fuel"
                    type="number"
                    name="fuel"
                    class="form-control"
                    id=""
                  />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">l</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-danger"
          data-dismiss="modal"
          style="background-color: #f68901"
        >
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button
          *ngIf="new"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          data-dismiss="modal"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button
          *ngIf="!new && !addNewWow"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="updateWow(wow)"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button
          *ngIf="!new && addNewWow"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          (click)="validDetailOfNewWow()"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
<!--Material modal-->
<div
  class="modal fade"
  id="materialModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">
          <i class="fa fa-sticky-note-o"></i> Učinci materijala
        </h4>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
          #closeButtonMaterialModal
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #materialModalForm="ngForm">
          <h5><i class="fa fa-leaf mr-2"></i> Materijal</h5>
          <h6>{{ spentMaterial.material.name }}</h6>
          <h6 *ngIf="spentMaterial.id != undefined">
            Planirana količina: {{ spentMaterial.quantity }}
            {{ spentMaterial.material.unit }}
          </h6>
          <hr class="solid" />
          <div class="form-group">
            <label for="quantity">Utrošena količina</label>
            <div class="input-group mb-3">
              <input
                [(ngModel)]="spentMaterial.spent"
                type="number"
                name="quantity"
                id="quantity"
                class="form-control"
                #quantity="ngModel"
                required
              />
              <div class="input-group-append">
                <span
                  class="input-group-text"
                  id="basic-addon2"
                  *ngIf="new; else elseBlockSpentMaterialModal"
                  >{{ unit }}</span
                >
                <ng-template #elseBlockSpentMaterialModal>
                  <span class="input-group-text" id="basic-addon2">{{
                    spentMaterial.material.unit
                  }}</span>
                </ng-template>
              </div>
            </div>

            <div
              *ngIf="quantity.invalid && clickAddMaterial"
              style="color: red"
            >
              Unesite količinu.
            </div>
          </div>
          <div class="form-group">
            <label for="quantityPerHectar">Utrošena količina po ha</label>
            <div class="input-group mb-3">
              <input
                *ngIf="new; else elseBlockSpentPerHectar"
                [(ngModel)]="spentMaterial.spent / crop.area"
                type="number"
                name="quantityPerHectar"
                id="quantityPerHectar"
                class="form-control"
                readonly
              />
              <div class="input-group-append" *ngIf="new">
                <span class="input-group-text" id="basic-addon2"
                  >{{ unit }}/ha</span
                >
              </div>
              <ng-template #elseBlockSpentPerHectar>
                <input
                  [(ngModel)]="spentMaterial.spent / workOrder.area"
                  type="number"
                  name="spentPerHectar"
                  id=""
                  class="form-control"
                  readonly
                />
                <div class="input-group-append">
                  <span class="input-group-text" id="basic-addon2"
                    >{{ spentMaterial.material.unit }}/ha</span
                  >
                </div>
              </ng-template>
            </div>
          </div>
          <div class="form-group">
            <label>Jedinica mere</label>
            <div class="input-group mb-3">
              <input
                *ngIf="new; else elseBlcokUnit"
                [(ngModel)]="unit"
                type="text"
                name="jm"
                id=""
                class="form-control"
                readonly
              />
              <ng-template #elseBlcokUnit>
                <input
                  [(ngModel)]="spentMaterial.material.unit"
                  type="text"
                  name="jm"
                  id=""
                  class="form-control"
                  readonly
                />
              </ng-template>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-danger"
          data-dismiss="modal"
          style="background-color: #f68901"
        >
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button
          *ngIf="new"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          data-dismiss="modal"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button
          *ngIf="!new && !addNewSpentMaterial"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          data-dismiss="modal"
          (click)="updateMaterial(spentMaterial)"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button
          *ngIf="!new && addNewSpentMaterial"
          type="button"
          class="btn btn-success"
          style="background-color: #33590b"
          data-dismiss="modal"
        >
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
