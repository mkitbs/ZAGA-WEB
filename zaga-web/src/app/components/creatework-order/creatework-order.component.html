<div class="container" style="margin-bottom: 4%;">
  <navbar></navbar>
</div>
<div class="container mt-4 d-none d-md-block" style="padding-top: 40px;">
  <div class="col-12 mb-3">
    <div class="button-group">
      <div class="row">
        <div class="col-3">
          <h3 *ngIf="new">Kreiranje naloga</h3>
          <h3 *ngIf="!new">Informacije o nalogu</h3>
          <span>Status: </span><span [ngClass]="{
              statusNovi: workOrder.status == 'Novi',
              statusURadu: workOrder.status == 'U radu',
              statusZatvoren: workOrder.status == 'Zatvoren',
              statusStorniran: workOrder.status == 'Storniran'
            }">{{ workOrder.status }}</span>
          <br>
          <span *ngIf="!new">Br. radnog naloga (SAP): {{workOrder.sapId}}</span><br>
          <span *ngIf="!new">Radni nalog kreirao/la: {{userCreator.name}} {{userCreator.surname}}</span>
        </div>
        <div class="col" style="float: right;">
         
            <button class="btn btn-danger blob" data-toggle="modal" data-target="#errorsModal"
              style="margin-left: 6px; float: right; border: none;" *ngIf="error">
              <i class="fa fa-exclamation-triangle"></i>
           
            </button>
          <button class="btn btn-primary btn-cancellation mr-2"
            *ngIf="!new && creator==loggedUser && workOrder.status != 'Storniran' && workOrder.status == 'Zatvoren'" 
            data-toggle="modal" data-target="#cancellationWorkOrderModal">
            <i class="fa fa-ban"></i> Storniraj radni nalog
          </button>
          <button class="btn btn-primary btn-edit"
            *ngIf="!new && workOrder.status != 'Zatvoren' && creator==loggedUser && workOrder.status != 'Storniran'"
            data-toggle="modal" data-target="#closeWOModal" style="margin-right: 5px;">
            <i class="fa fa-check"></i> Zatvori RN i proknjiži materijal
          </button>
          <button class="btn btn-primary btn-add mr-2"
            *ngIf="!new && workOrder.status != 'Zatvoren' && creator==loggedUser && workOrder.status != 'Storniran'"
            (click)="checkIfStartedCreation()">
            <i class="fa fa-save mr-2"></i> Sačuvaj radni nalog
          </button>
          <button class="btn btn-primary btn-add mr-2" *ngIf="new" (click)="addWorkOrder(infoWorkOrderForm)">
            <i class="fa fa-save mr-2"></i> Sačuvaj
          </button>
        </div>
      </div>
    </div>
  </div>
  <!--header info-->
  <div class="header-info">
    <form #infoWorkOrderForm="ngForm">
      <table class="table header-table"
        [ngClass]="workOrder.status == 'Zatvoren' || workOrder.status == 'Storniran' ? 'disableAll' : null">
        <tr>
          <!--Datum-->
          <td class="left-col-header">
            <i class="fa fa-calendar mr-2"></i>Datum radnog naloga:
          </td>
          <td class="right-col-header">
            <div class="input-group mb-3">
              <input [(ngModel)]="workOrder.date" name="poc" ngbDatepicker #od="ngbDatepicker" (click)="od.toggle()"
                class="form-control" #dateFrom="ngModel" required />
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="od.toggle()" type="button"></button>
              </div>
            </div>

            <div *ngIf="dateFrom == null && clickAddWorkOrder" style="color: red; font-weight: normal">
              Izaberite datum.
            </div>
          </td>
          <!--Godina-->
          <td class="left-col-header">
           <i class="fa fa-calendar-check-o mr-2"></i> Godina:
          </td>
          <td class="right-col-header">
            <select name="year" [(ngModel)]="workOrder.year" id="" class="form-control" *ngIf="!new; else elseBlockYear"
              (change)="getCulture()" style="margin-bottom: 10px;">
              <option value="{{previousYear}}">{{previousYear}}</option>
              <option value="{{currentYear}}">{{currentYear}}</option>
              <option value="{{nextYear}}">{{nextYear}}</option>
            </select>
            <ng-template #elseBlockYear>
              <select name="selYear" [(ngModel)]="selectedYear" id="" class="form-control" #year="ngModel" required
                (change)="getCulture()" style="margin-bottom: 10px;">
                <option value="{{previousYear}}">{{previousYear}}</option>
                <option value="{{currentYear}}" selected>{{currentYear}}</option>
                <option value="{{nextYear}}">{{nextYear}}</option>
              </select>
              <div *ngIf="year.invalid && clickAddWorkOrder" style="color: red; font-weight: normal">
                Izaberite godinu.
              </div>
            </ng-template>
          </td>
        </tr>
        <tr>
          <!--Parcela-->
          <td class="left-col-header">
            <i class="fa fa-map-marker mr-2"></i>Parcela:
          </td>
          <td class="right-col-header">
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockField">
                <input type="text" matInput [formControl]="fieldFC" [matAutocomplete]="autoField" #searchField required
                  placeholder="Izaberite parcelu" />

                <mat-autocomplete #autoField="matAutocomplete" [displayWith]="displayFnField" place>
                  <mat-option *ngFor="
                      let field of fields | SearchFields: searchField.value
                    " [value]="field" (click)="getCulture()">
                    {{field.Id}} - {{ field.Name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockField>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="fieldFC" [matAutocomplete]="autoFieldWithoutId"
                    #searchFieldWithoutId required placeholder="Izaberite parcelu" />

                  <mat-autocomplete #autoFieldWithoutId="matAutocomplete" [displayWith]="displayFnWithoutId" place>
                    <mat-option *ngFor="
                        let field of fields | SearchFields: searchFieldWithoutId.value
                      " [value]="field" (click)="getCulture()">
                      {{ field.Name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="fieldFC.invalid && clickAddWorkOrder" style="color: red; font-weight: normal">
                Izaberite parcelu.
              </div>
            </form>
          </td>
          <!--Usev-->
          <td class="left-col-header"><i class="fa fa-cubes"></i> Usev:</td>
          <td class="right-col-header">
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockCulture">
                <input type="text" matInput [formControl]="cultureFC" [matAutocomplete]="autoCulture" #searchCulture
                  required placeholder="Izaberite usev, nakon što izaberete parcelu" />

                <mat-autocomplete #autoCulture="matAutocomplete" [displayWith]="displayFnCulture" place>
                  <mat-option *ngFor="
                    let crop of crops | SearchCultures: searchCulture.value
                    " [value]="crop" (click)="getArea(crop.id)">
                    {{crop.Id}} - {{ crop.Name }} ({{crop.CultureId}} - {{crop.cultureName}})
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockCulture>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="cultureFC" [matAutocomplete]="autoCultureWithoutId"
                    #searchCultureWithoutId required placeholder="Izaberite usev, nakon što izaberete parcelu" />

                  <mat-autocomplete #autoCultureWithoutId="matAutocomplete" [displayWith]="displayFnCultureWithoutId"
                    place>
                    <mat-option *ngFor="
                      let crop of crops | SearchCultures: searchCultureWithoutId.value
                      " [value]="crop" (click)="getArea(crop.id)">
                      {{ crop.Name }} ({{crop.cultureName}})
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="cultureFC.valid == false && clickAddWorkOrder" style="color: red; font-weight: normal">
                Izaberite usev.
              </div>
            </form>
          </td>
        </tr>
        <tr>
          <!--ATM-->
          <td class="left-col-header">
            <i class="fa fa-file mr-2"></i>ATM:
          </td>
          <td class="right-col-header">
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockOp">
                <input type="text" matInput [formControl]="operationFC" [matAutocomplete]="autoOp" #searchOp required
                  placeholder="Izaberite agrotehničku meru" />

                <mat-autocomplete #autoOp="matAutocomplete" [displayWith]="displayFnOperation" place>
                  <mat-option *ngFor="
                      let op of operations | SearchOperations: searchOp.value
                    " [value]="op" (click)="getOperation(op)">
                    {{op.Id}} - {{ op.Name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockOp>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="operationFC" [matAutocomplete]="autoOpWithoutId"
                    #searchOpWithoutId required placeholder="Izaberite agrotehničku meru" />

                  <mat-autocomplete #autoOpWithoutId="matAutocomplete" [displayWith]="displayFnWithoutId" place>
                    <mat-option *ngFor="
                        let op of operations | SearchOperations: searchOpWithoutId.value
                      " [value]="op" (click)="getOperation(op)">
                      {{ op.Name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="operationFC.invalid && clickAddWorkOrder" style="color: red; font-weight: normal">
                Izaberite agrotehničku meru.
              </div>
            </form>
          </td>

          <!--Odgovorna osoba-->
          <td class="left-col-header">
            <i class="fa fa-user mr-2"></i>Odgovorna osoba:
          </td>
          <td class="right-col-header">
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockResponsible">
                <input type="text" matInput [formControl]="nameFC" [matAutocomplete]="auto" #search style="width: 100%"
                  required placeholder="Izaberite odgovornu osobu" />

                <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn" place>
                  <mat-option *ngFor="
                      let emp of allEmployees | SearchEmployees: search.value
                    " [value]="emp">
                    {{emp.perNumber}} - {{ emp.name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockResponsible>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="nameFC" [matAutocomplete]="autoWithoutId" #searchWithoutId
                    required placeholder="Izaberite odgovornu osobu" />

                  <mat-autocomplete #autoWithoutId="matAutocomplete" [displayWith]="displayFnResponsible" place>
                    <mat-option *ngFor="
                        let emp of allEmployees | SearchEmployees: searchWithoutId.value
                      " [value]="emp">
                      {{ emp.name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="nameFC.valid == false && clickAddWorkOrder" style="color: red; font-weight: normal">
                Izaberite odgovornu osobu.
              </div>
            </form>
          </td>
        </tr>
        <tr>
          <!--Referentni nalog-->
          <td class="left-col-header">
            <i class="fa fa-slack mr-2"></i>Broj referentnog naloga:
          </td>
          <td class="right-col-header">
            <form>
              <mat-form-field class="inputAuto">
                <input matInput type="text" name="numberOfReferenceOrder" [formControl]="numOfRefOrderFC"
                  placeholder="Unesite broj referentnog naloga, ukoliko želite" maxlength="40">
              </mat-form-field>
            </form>
          </td>
          <!--Napomena-->
          <td class="left-col-header">
            <i class="fa fa-comment mr-2"></i>Napomena:
          </td>
          <td class="right-col-header">
            <form>
              <mat-form-field class="inputAuto">
                <input matInput type="text" name="note" [formControl]="noteFC" placeholder="Unesite napomenu, ukoliko želite" maxlength="100">
              </mat-form-field>
            </form>
          </td>

        </tr>
        <!--Povrsina-->
        <tr>
          <td class="left-col-header"><i class="fa fa-clone"></i> Površina:</td>
          <td class="right-col-header">
            <div class="input-group mb-3">
              <input type="text" name="area" [(ngModel)]="workOrder.area" id="" class="form-control" #area="ngModel"
                required readonly />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">ha</span>
              </div>
            </div>

            <div *ngIf="area.invalid && clickAddWorkOrder" style="color: red; font-weight: normal">
              Unesite površinu.
            </div>
          </td>
          <!--Obradjeno-->
          <td class="left-col-header">
            <span *ngIf="!new" style="padding-top: 5px;"> <i class="fa fa-flag mr-2"></i>Obrađeno: </span>
          </td>
          <td class="right-col-header2">
            <div class="input-group mb-3" *ngIf="!new">
              <div class="input-group">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <input *ngIf="workOrder.noOperationOutput" checked type="checkbox" [(ngModel)]="noOperationOutput" name="noOpOutput" [ngModelOptions]="{standalone: true}" (click)="disableTreated()">
                    <input *ngIf="!workOrder.noOperationOutput" type="checkbox" [(ngModel)]="noOperationOutput" name="noOpOutput" [ngModelOptions]="{standalone: true}" (click)="disableTreated()">
                  </div>
                </div>
                    
              <input type="number" onKeyPress="if(this.value.length==6) return false;" name="treated"
                    [(ngModel)]="treatedEntered" id="" class="form-control" 
                    (change)="calculateQuantityPerHectar()" [disabled]="noOperationOutput" />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">ha</span>
                  </div>
                </div>
                <i *ngIf="!new" style="color: black; opacity: 70%; margin-bottom: 0px; font-size: smaller;">
                  *Čekirajte ukoliko je radni nalog opšti.
                </i>
            </div>
            
            <div *ngIf="validWoInfo == false && clickCloseWorkOrder" style="color: red; font-weight: normal">
              Unesite površinu.
            </div>
            <div *ngIf="validTreated == false && clickUpdateWo" style="color: red; font-weight: normal">
              Površina mora biti veća ili jednaka nuli.
            </div>
            
          </td>
        </tr>
      </table>
    </form>
  </div>
  <!--workers/machines-->
  <div class="machines mt-4">
    <button class="btn btn-primary collapsing-button shadow-none" (click)="expandMachines()" type="button"
      data-toggle="collapse" data-target="#collapseExampleMachines" aria-expanded="false"
      aria-controls="collapseExampleMachines">
      <i class="fa fa-user mr-2"></i>
      <i class="fa fa-truck mr-2"></i>
      Izvršioci/Mašine<i *ngIf="!machines" class="fa fa-arrow-down mr-2 mt-1 arrows" data-toggle="collapse"
        data-target="#collapseExampleMachines" aria-expanded="false" aria-controls="collapseExampleMachines"></i><i
        *ngIf="machines" class="fa fa-arrow-up mr-2 mt-1 arrows" data-toggle="collapse"
        data-target="#collapseExampleMachines" aria-expanded="false" aria-controls="collapseExampleMachines"></i>
    </button>
    <div class="collapse" id="collapseExampleMachines">
      <div class="card card-body collapse-card">
        <h5>Unos novog izvršioca/mašine:</h5>
        <form #wowForm="ngForm">
          <div class="table-responsive">
            <table class="table table-borderless table-input"  [ngClass]="workOrder.status == 'Zatvoren' || workOrder.status == 'Storniran' ? 'disableAll' : null">
              <thead>
                <th>Izvršioc*</th>
                <th>ATM*</th>
                <th>Mašina*</th>
                <th>Priključna mašina*</th>
               <!-- <th style="text-align: right !important" *ngIf="!new"></th>-->
                <th style="text-align: right !important"></th>
               <!-- <th style="text-align: right !important" *ngIf="wows.length > 0 || (workOrder.workers.length > 0 && !emptyWow)">
                  
                </th>
                -->
              </thead>
              <tbody>
                <tr>
                  <td>
                    <!--Izvrsioc-->
                    <div class="form-group">
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorker">
                          <input type="text" matInput [formControl]="workerFC" [matAutocomplete]="autoWorker"
                            #searchWorker required placeholder="Izaberite izvršioca" />

                          <mat-autocomplete #autoWorker="matAutocomplete" [displayWith]="displayFn" place>
                            <mat-option *ngFor="
                              let emp of allEmployees | SearchEmployees: searchWorker.value
                            " [value]="emp">
                              {{emp.perNumber}} - {{ emp.name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockWorker>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [formControl]="workerFC" [matAutocomplete]="autoWorkerWithoutId"
                              #searchWorkerWithoutId required placeholder="Izaberite izvršioca" />

                            <mat-autocomplete #autoWorkerWithoutId="matAutocomplete" [displayWith]="displayFnResponsible"
                              place>
                              <mat-option *ngFor="
                                let emp of allEmployees | SearchEmployees: searchWorkerWithoutId.value
                              " [value]="emp">
                                {{ emp.name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                        <div *ngIf="workerFC.invalid && clickAddWorkerMachine == true"
                          style="color: red; font-weight: normal; text-align: left;">
                          Izvršioc je obavezno polje.<br> Popunite ga.
                        </div>
                      </form>
                    </div>
                  </td>
                  <td>
                    <!--ATM-->
                    <div class="form-group">
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorkerOp">
                          <input type="text" matInput [formControl]="workerOperationFC" [matAutocomplete]="autoWorkerOp"
                            #searchWorkerOp required placeholder="Izaberite agrotehničku meru" />

                          <mat-autocomplete #autoWorkerOp="matAutocomplete" [displayWith]="displayFnOperation" place>
                            <mat-option *ngFor="
                                let op of operations | SearchOperations: searchWorkerOp.value
                              " [value]="op">
                              {{ op.Id }} - {{ op.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockWorkerOp>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [formControl]="workerOperationFC"
                              [matAutocomplete]="autoWorkerOpWithoutId" #searchWorkerOpWithoutId required
                              placeholder="Izaberite agrotehničku meru" />

                            <mat-autocomplete #autoWorkerOpWithoutId="matAutocomplete" [displayWith]="displayFnWithoutId"
                              place>
                              <mat-option *ngFor="
                                  let op of operations | SearchOperations: searchWorkerOpWithoutId.value
                                " [value]="op">
                                {{ op.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                        <div *ngIf="workerOperationFC.invalid && clickAddWorkerMachine == true"
                          style="color: red; font-weight: normal; text-align: left;">
                          ATM je obavezno polje.<br>Popunite ga.
                        </div>
                      </form>
                    </div>
                  </td>
                  <td>
                    <!--Masina-->
                    <div class="form-group">
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorkerMachine">
                          <input type="text" matInput [formControl]="workerMachineFC"
                            [matAutocomplete]="autoWorkerMachine" #searchWorkerMachine required
                            placeholder="Izaberite mašinu" />

                          <mat-autocomplete #autoWorkerMachine="matAutocomplete" [displayWith]="displayFnMachine" place>
                            <mat-option *ngFor="
                            let dev of devicesPropulsion | SearchPropulsionMachines: searchWorkerMachine.value
                              " [value]="dev">
                              {{dev.Id}} - {{ dev.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockWorkerMachine>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [formControl]="workerMachineFC"
                              [matAutocomplete]="autoWorkerMachineWithoutId" #searchWorkerMachineWithoutId required
                              placeholder="Izaberite mašinu" />

                            <mat-autocomplete #autoWorkerMachineWithoutId="matAutocomplete"
                              [displayWith]="displayFnMachineWithoutId" place>
                              <mat-option *ngFor="
                              let dev of devicesPropulsion | SearchPropulsionMachines: searchWorkerMachineWithoutId.value
                                " [value]="dev">
                                {{ dev.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                        <div *ngIf="workerMachineFC.invalid && clickAddWorkerMachine == true"
                          style="color: red; font-weight: normal; text-align: left;">
                          Mašina je obavezno polje.<br>Popunite ga.
                        </div>
                      </form>
                    </div>
                  </td>
                  <td>
                    <!--Prikljucna masina-->
                    <div class="form-group">
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorkerCoMachine">
                          <input type="text" matInput [formControl]="workerCoMachineFC"
                            [matAutocomplete]="autoWorkerCoMachine" #searchWorkerCoMachine required
                            placeholder="Izaberite priključnu mašinu" />

                          <mat-autocomplete #autoWorkerCoMachine="matAutocomplete" [displayWith]="displayFnMachine" place>
                            <mat-option [value]="-1">
                              BEZ PRIKLJUČNE MAŠINE
                            </mat-option>
                            <mat-option *ngFor="
                            let dev of devicesCoupling | SearchCouplingMachines: searchWorkerCoMachine.value
                              " [value]="dev">
                              {{dev.Id}} - {{ dev.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockWorkerCoMachine>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [formControl]="workerCoMachineFC"
                              [matAutocomplete]="autoWorkerCoMachineWithoutId" #searchWorkerCoMachineWithoutId required
                              placeholder="Izaberite priključnu mašinu" />

                            <mat-autocomplete #autoWorkerCoMachineWithoutId="matAutocomplete"
                              [displayWith]="displayFnMachineWithoutId" place>
                              <mat-option [value]="-1">
                                BEZ PRIKLJUČNE MAŠINE
                              </mat-option>
                              <mat-option *ngFor="
                              let dev of devicesCoupling | SearchCouplingMachines: searchWorkerCoMachineWithoutId.value
                                " [value]="dev">
                                {{ dev.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                        <div *ngIf="workerCoMachineFC.invalid && clickAddWorkerMachine == true"
                          style="color: red; font-weight: normal; text-align: left;">
                          Priključna mašina je obavezno polje.<br>Popunite ga.
                        </div>
                      </form>
                    </div>
                  </td>
                   <!---
                  <td *ngIf="!new">
                   
                    <div class="form-group">
                      <button class="btn btn-primary btn-add mr-2" data-toggle="modal" data-target="#workerMachineModal"
                        (click)="addDetailWow()">
                        <i class="fa fa-ellipsis-v"></i>
                      </button>
                    </div>
                   
                  </td>
                   -->
                  <td>
                    <div *ngIf="new" class="form-group">
                      <button class="btn btn-primary btn-add" (click)="addWorkerAndMachine(wowForm.valid)"
                        [disabled]="workOrder.status == 'Zatvoren'" style="width: 70px !important;">
                        <i class="fa fa-plus"></i> Dodaj
                      </button>
                    </div>
                    <div *ngIf="!new" class="form-group">
                      <button class="btn btn-primary btn-add" (click)="addNewWorkerAndMachine()"
                        [disabled]="workOrder.status == 'Zatvoren' || creator!=loggedUser" style="width: 70px !important; margin-left: 10px;">
                      
                        <i class="fa fa-plus"></i> Dodaj
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="7"><hr style="height:2px;border-width:0;color:gray;background-color:#33590b"></td>
                </tr>
                <!--editable table worker/machine new wo-->
                <tr *ngIf="new && wows.length > 0">
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Potrvda izmene</td>
                  <td>Obriši</td>
                </tr>
                <tr *ngIf="!new && workOrder.workers.length > 0">
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td style="float: right;">Učinci</td>
                  <td>Promena</td>
                  <td>Obriši</td>

                </tr>
                <ng-container *ngIf="new; else elseBlockMachineState">

                  <tr *ngFor="let wow of wows">
                    <td>
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExWorker">
                          <input type="text" matInput [(ngModel)]="wow.user" [ngModelOptions]="{ standalone: true }"
                            [matAutocomplete]="autoExWorker" #searchWorker required />

                          <mat-autocomplete #autoExWorker="matAutocomplete" [displayWith]="displayFn" place>
                            <mat-option *ngFor="
                              let emp of allEmployees | SearchEmployees: searchWorker.value
                            " [value]="emp">
                              {{emp.perNumber}} - {{ emp.name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockExWorker>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [(ngModel)]="wow.user" [ngModelOptions]="{ standalone: true }"
                              [matAutocomplete]="autoExWorkerWithoutId" #searchWorkerWithoutId required />

                            <mat-autocomplete #autoExWorkerWithoutId="matAutocomplete"
                              [displayWith]="displayFnResponsible" place>
                              <mat-option *ngFor="
                                let emp of allEmployees | SearchEmployees: searchWorkerWithoutId.value
                              " [value]="emp">
                                {{ emp.name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                      </form>
                    </td>
                    <td>
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExWorkerOp">
                          <input type="text" matInput [(ngModel)]="wow.operation" [ngModelOptions]="{ standalone: true }"
                            [matAutocomplete]="autoExWorkerOp" #searchWorkerOp required />

                          <mat-autocomplete #autoExWorkerOp="matAutocomplete" [displayWith]="displayFnOperation" place>
                            <mat-option *ngFor="
                                let op of operations | SearchOperations: searchWorkerOp.value
                              " [value]="op">
                              {{ op.Id }} - {{ op.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockExWorkerOp>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [(ngModel)]="wow.operation"
                              [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExWorkerOpWithoutId"
                              #searchWorkerOpWithoutId required />

                            <mat-autocomplete #autoExWorkerOpWithoutId="matAutocomplete"
                              [displayWith]="displayFnWithoutId" place>
                              <mat-option *ngFor="
                                  let op of operations | SearchOperations: searchWorkerOpWithoutId.value
                                " [value]="op">
                                {{ op.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                      </form>
                    </td>
                    <td>
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExWorkerMachine">
                          <input type="text" matInput [(ngModel)]="wow.machine" [ngModelOptions]="{ standalone: true }"
                            [matAutocomplete]="autoExWorkerMachine" #searchWorkerMachine required />

                          <mat-autocomplete #autoExWorkerMachine="matAutocomplete" [displayWith]="displayFnMachine" place>
                            <mat-option *ngFor="
                            let dev of devicesPropulsion | SearchPropulsionMachines: searchWorkerMachine.value
                              " [value]="dev">
                              {{dev.Id}} - {{ dev.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockExWorkerMachine>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [(ngModel)]="wow.machine" [ngModelOptions]="{ standalone: true }"
                              [matAutocomplete]="autoExWorkerMachineWithoutId" #searchWorkerMachineWithoutId required />

                            <mat-autocomplete #autoExWorkerMachineWithoutId="matAutocomplete"
                              [displayWith]="displayFnMachineWithoutId" place>
                              <mat-option *ngFor="
                              let dev of devicesPropulsion | SearchPropulsionMachines: searchWorkerMachineWithoutId.value
                                " [value]="dev">
                                {{ dev.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                      </form>
                    </td>
                    <td>
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExWorkerCoMachine">
                          <input type="text" matInput [(ngModel)]="wow.connectingMachine"
                            [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExWorkerCoMachine"
                            #searchWorkerCoMachine required />

                          <mat-autocomplete #autoExWorkerCoMachine="matAutocomplete" [displayWith]="displayFnMachine"
                            place>
                            <mat-option [value]="-1">
                              BEZ PRIKLJUČNE MAŠINE
                            </mat-option>
                            <mat-option *ngFor="
                            let dev of devicesCoupling | SearchCouplingMachines: searchWorkerCoMachine.value
                              " [value]="dev">
                              {{dev.Id}} - {{ dev.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockExWorkerCoMachine>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [(ngModel)]="wow.connectingMachine"
                              [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExWorkerCoMachineWithoutId"
                              #searchWorkerCoMachineWithoutId required />

                            <mat-autocomplete #autoExWorkerCoMachineWithoutId="matAutocomplete"
                              [displayWith]="displayFnMachineWithoutId" place>
                              <mat-option [value]="-1">
                                BEZ PRIKLJUČNE MAŠINE
                              </mat-option>
                              <mat-option *ngFor="
                              let dev of devicesCoupling | SearchCouplingMachines: searchWorkerCoMachineWithoutId.value
                                " [value]="dev">
                                {{ dev.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                      </form>
                    </td>
                    <!--
                    <td>
                      <div class="form-group">
                        <button
                          class="btn btn-primary btn-add mr-2"
                          data-toggle="modal"
                          data-target="#workerMachineModal"
                          (click)="editWorkerAndMachine(wow)"
                        >
                          <i class="fa fa-ellipsis-v"></i>
                        </button>
                      </div>
                    </td>
                    -->
                    <td>
                      <button class="btn btn-primary btn-add mr-2" (click)="editExistingWorkerAndMachine(wow)"
                        style="width: 80px !important;">
                        <i class="fa fa-check"></i> Sačuvaj
                      </button>
                    </td>
                    <td>
                      <div class="form-group">
                        <button class="btn btn-primary btn-delete mr-2" (click)="deleteWorkOrderWorker(wow)">
                          <i class="fa fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>

                </ng-container>
                <!--editable table worker/machine existing wo-->
                <ng-template #elseBlockMachineState>

                  <tr *ngFor="let wow of workOrder.workers">
                    <ng-container *ngIf="!wow.deleted">
                      <td>
                        <form>
                          <!--WITH SAP ID-->
                          <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExDbWorker">
                            <input type="text" matInput [(ngModel)]="wow.user" [ngModelOptions]="{ standalone: true }"
                              [matAutocomplete]="autoExDbWorker" #searchExDbWorker required />

                            <mat-autocomplete #autoExDbWorker="matAutocomplete" [displayWith]="displayFn" place>
                              <mat-option *ngFor="
                                let emp of allEmployees | SearchEmployees: searchExDbWorker.value
                              " [value]="emp">
                                {{emp.perNumber}} - {{ emp.name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                          <!--WITHOUT SAP ID-->
                          <ng-template #elseBlockExDbWorker>
                            <mat-form-field class="inputAuto">
                              <input type="text" matInput [(ngModel)]="wow.user" [ngModelOptions]="{ standalone: true }"
                                [matAutocomplete]="autoExDbWorkerWithoutId" #searchExDbWorkerWithoutId required />

                              <mat-autocomplete #autoExDbWorkerWithoutId="matAutocomplete"
                                [displayWith]="displayFnResponsible" place>
                                <mat-option *ngFor="
                                  let emp of allEmployees | SearchEmployees: searchExDbWorkerWithoutId.value
                                " [value]="emp">
                                  {{ emp.name }}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </ng-template>
                        </form>
                      </td>
                      <td>
                        <form>
                          <!--WITH SAP ID-->
                          <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExDbWorkerOp">
                            <input type="text" matInput [(ngModel)]="wow.operation"
                              [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExDbWorkerOp"
                              #searchExDbWorkerOp required />

                            <mat-autocomplete #autoExDbWorkerOp="matAutocomplete" [displayWith]="displayFnOperation"
                              place>
                              <mat-option *ngFor="
                                let op of operations | SearchOperations: searchExDbWorkerOp.value
                              " [value]="op">
                                {{ op.Id }} - {{ op.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                          <!--WITHOUT SAP ID-->
                          <ng-template #elseBlockExDbWorkerOp>
                            <mat-form-field class="inputAuto">
                              <input type="text" matInput [(ngModel)]="wow.operation"
                                [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExDbWorkerOpWithoutId"
                                #searchExDbWorkerOpWithoutId required />

                              <mat-autocomplete #autoExDbWorkerOpWithoutId="matAutocomplete"
                                [displayWith]="displayFnWithoutId" place>
                                <mat-option *ngFor="
                                  let op of operations | SearchOperations: searchExDbWorkerOpWithoutId.value
                                " [value]="op">
                                  {{ op.Name }}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </ng-template>
                        </form>
                      </td>
                      <td>
                        <form>
                          <!--WITH SAP ID-->
                          <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExDbWorkerMachine">
                            <input type="text" matInput [(ngModel)]="wow.machine" [ngModelOptions]="{ standalone: true }"
                              [matAutocomplete]="autoExDbWorkerMachine" #searchExDbWorkerMachine required />

                            <mat-autocomplete #autoExDbWorkerMachine="matAutocomplete" [displayWith]="displayFnMachine"
                              place>
                              <mat-option *ngFor="
                            let dev of devicesPropulsion | SearchPropulsionMachines: searchExDbWorkerMachine.value
                              " [value]="dev">
                                {{dev.Id}} - {{ dev.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                          <!--WITHOUT SAP ID-->
                          <ng-template #elseBlockExDbWorkerMachine>
                            <mat-form-field class="inputAuto">
                              <input type="text" matInput [(ngModel)]="wow.machine"
                                [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExDbWorkerMachineWithoutId"
                                #searchExDbWorkerMachineWithoutId required />

                              <mat-autocomplete #autoExDbWorkerMachineWithoutId="matAutocomplete"
                                [displayWith]="displayFnMachineWithoutId" place>
                                <mat-option *ngFor="
                              let dev of devicesPropulsion | SearchPropulsionMachines: searchExDbWorkerMachineWithoutId.value
                                " [value]="dev">
                                  {{ dev.Name }}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </ng-template>
                        </form>
                      </td>
                      <td>
                        <form>
                          <!--WITH SAP ID-->
                          <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExDbWorkerCoMachine">
                            <input type="text" matInput [(ngModel)]="wow.connectingMachine"
                              [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExDbWorkerCoMachine"
                              #searchExDbWorkerCoMachine required />

                            <mat-autocomplete #autoExDbWorkerCoMachine="matAutocomplete" [displayWith]="displayFnMachine"
                              place>
                              <mat-option [value]="-1">
                                BEZ PRIKLJUČNE MAŠINE
                              </mat-option>
                              <mat-option *ngFor="
                            let dev of devicesCoupling | SearchCouplingMachines: searchExDbWorkerCoMachine.value
                              " [value]="dev">
                                {{dev.Id}} - {{ dev.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                          <!--WITHOUT SAP ID-->
                          <ng-template #elseBlockExDbWorkerCoMachine>
                            <mat-form-field class="inputAuto">
                              <input type="text" matInput [(ngModel)]="wow.connectingMachine"
                                [ngModelOptions]="{ standalone: true }"
                                [matAutocomplete]="autoExDbWorkerCoMachineWithoutId" #searchExDbWorkerCoMachineWithoutId
                                required />

                              <mat-autocomplete #autoExDbWorkerCoMachineWithoutId="matAutocomplete"
                                [displayWith]="displayFnMachineWithoutId" place>
                                <mat-option [value]="-1">
                                  BEZ PRIKLJUČNE MAŠINE
                                </mat-option>
                                <mat-option *ngFor="
                              let dev of devicesCoupling | SearchCouplingMachines: searchExDbWorkerCoMachineWithoutId.value
                                " [value]="dev">
                                  {{ dev.Name }}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </ng-template>
                        </form>
                      </td>
                      <td>
                        <div class="form-group">
                          <button *ngIf="wow.machine.Id=='BEZ-MASINE' || fieldFC.value.Id == 999997 || foreignMachine" class="btn btn-primary btn-add mr-2" data-toggle="modal"
                            data-target="#workerMachineModal" (click)="editWorkerAndMachine(wow.id)" id="{{ wow.id }}"
                            [ngClass]="wow.dayPeriod == null || wow.nightPeriod == null || wow.dayPeriod == -1 || wow.nightPeriod == -1 ? 
                              'warning' : 'ok'">
                            <i class="fa fa-ellipsis-v"></i>
                          </button>
                          <button *ngIf="wow.machine.Id!='BEZ-MASINE' && fieldFC.value.Id != 999997 && !foreignMachine" class="btn btn-primary btn-add mr-2" data-toggle="modal"
                            data-target="#workerMachineModal" (click)="editWorkerAndMachine(wow.id)" id="{{ wow.id }}"
                            [ngClass]="wow.dayPeriod == null || 
                          wow.nightPeriod == null || wow.initialState == null || wow.finalState == null || 
                          wow.fuel == null || wow.dayPeriod == -1 || wow.nightPeriod == -1 || 
                          wow.initialState == -1 || wow.finalState == -1 || wow.fuel == -1 ? 
                          'warning' : 'ok'">
                            <i class="fa fa-ellipsis-v"></i>
                          </button>
                        </div>
                      </td>
                      <td>
                        <button class="btn btn-primary btn-add mr-2" (click)="updateWOWBasicInfo(wow)"
                          [disabled]="workOrder.status == 'Zatvoren' || creator!=loggedUser" style="width: 80px !important;">
                          <i class="fa fa-check"></i> Sačuvaj
                        </button>
                      </td>
                      <td>
                        <div class="form-group">
                          <button class="btn btn-primary btn-delete mr-2" data-toggle="modal" data-target="#deleteWorkerModal" (click)="setWowId(wow.id)"
                            [disabled]="workOrder.status == 'Zatvoren' || creator!=loggedUser">
                            <i class="fa fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </ng-container>
                  </tr>

                </ng-template>
              </tbody>
            </table>
          </div>
          <div class="col-12">

            <i *ngIf="wows.length == 0 && new">Dodajte izvršioce (i mašine)</i>
            <br>

            <i *ngIf="workOrder.workers.length == 0 && !new">Dodajte izvršioce (i mašine)</i><br>
            <i *ngIf="!new">*Polja koja su obavezna za unos</i>

          </div>
        </form>
      </div>
    </div>
  </div>
  <!--materials-->
  <div class="machines mt-4">
    <button class="btn btn-primary collapsing-button shadow-none" (click)="expandMaterials()" type="button"
      data-toggle="collapse" data-target="#collapseExampleMaterials" aria-expanded="false"
      aria-controls="collapseExampleMachines">
      <i class="fa fa-leaf mr-2"></i>Materijali<i *ngIf="!materials" class="fa fa-arrow-down mr-2 mt-1 arrows"
        data-toggle="collapse" data-target="#collapseExampleMaterials" aria-expanded="false"
        aria-controls="collapseExampleMachines"></i><i *ngIf="materials" class="fa fa-arrow-up mr-2 mt-1 arrows"
        data-toggle="collapse" data-target="#collapseExampleMaterials" aria-expanded="false"
        aria-controls="collapseExampleMachines"></i>
    </button>
    <div class="collapse" id="collapseExampleMaterials">
      <div class="card card-body collapse-card">
        <form #materialForm="ngForm">
          <h5>Unos novog materijala:</h5>
          <div class="table-responsive">
            <table class="table table-borderless table-input"  [ngClass]="workOrder.status == 'Zatvoren' || workOrder.status == 'Storniran' ? 'disableAll' : null">
              <thead>
                <th>Materijal*</th>
                <th style="width: 150px">Planirana količina*</th>
                <th *ngIf="!new" style="width: 150px">Planirana količina / ha<span style="color: #f68901;">*</span></th>
                <!--<th style="text-align: right !important" *ngIf="!new">Učinci</th>-->
                <th style="text-align: right !important"></th>
                <!--<th style="text-align: right !important" *ngIf="woMaterials.length > 0 || workOrder.materials.length > 0">
                  Obriši
                </th>-->
              </thead>
              <tbody>
                <tr>
                  <td>
                    <div class="form-group">
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockMaterial">
                          <input type="text" matInput [formControl]="materialFC" [matAutocomplete]="autoMaterial"
                            #searchMaterial required placeholder="Izaberite materijal" />

                          <mat-autocomplete #autoMaterial="matAutocomplete" [displayWith]="displayFnMaterial">
                            <mat-option *ngFor="
                            let sub of (substances$ | async) | SearchMaterials: searchMaterial.value
                              " [value]="sub" (click)="getUnitOfMaterial(sub.dbid)">
                              {{sub.Id}} - {{ sub.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockMaterial>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [formControl]="materialFC"
                              [matAutocomplete]="autoMaterialWithoutId" #searchMaterialWithoutId required
                              placeholder="Izaberite materijal" />

                            <mat-autocomplete #autoMaterialWithoutId="matAutocomplete" [displayWith]="displayFnWithoutId"
                              place>
                              <mat-option *ngFor="
                              let sub of (substances$ | async) | SearchMaterials: searchMaterialWithoutId.value
                                " [value]="sub" (click)="getUnitOfMaterial(sub.dbid)">
                                {{ sub.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                        <div *ngIf="materialFC.invalid && clickAddMaterial" style="color: red; text-align: left;">
                          Materijal je obavezno polje. <br>Popunite ga.
                        </div>
                      </form>
                    </div>

                  </td>
                  <td>
                    <div class="form-group">
                      <div class="input-group mb-3">
                        <mat-form-field class="inputAuto">
                          <input [(ngModel)]="quantityEntered" onKeyPress="if(this.value.length==7) return false;"
                            type="number" name="quantityEnter" placeholder="Unesite količinu" id="" matInput #quantity="ngModel" required />
                            <span matSuffix>{{unit}}</span>
                        </mat-form-field>
                        <div *ngIf="(quantityEntered == null || quantityEntered == undefined) && clickAddMaterial"
                          style="color: red; text-align: left;">
                          Planirana količina je obavezno polje.<br>Popunite ga.
                        </div>
                        <div
                          *ngIf="(validMaterialQuantity == false && clickAddNewMaterial) || (validMaterialQuantity == false && clickAddMaterial)"
                          style="color: red">
                          Uneta količina mora biti veća od nule.
                        </div>
                        <div *ngIf="quantity.errors && clickAddNewMaterial" style="color: red">
                          Uneta količina ne sme biti duža od 7 cifara.
                        </div>
                      </div>
                    </div>
                  </td>
                  <td *ngIf="!new" style="width: 100px;">
                    <div class="form-group">
                      <div class="input-group mb-3">
                          <mat-form-field class="inputAuto" *ngIf="new; else elseBlockQuantity">
                            <input  [(ngModel)]="quantityEntered / crop.Area" type="number"
                              name="quantityPerHectar" id="" matInput disabled />
                            <span matSuffix>{{unit}}/ha</span>
                          </mat-form-field>
                      
                        <ng-template #elseBlockQuantity>
                          <mat-form-field class="inputAuto" style="width: 100px;">
                            <input [(ngModel)]="quantityEntered / workOrder.treated" type="number" name="quantityPerHectar"
                              id="" matInput disabled  />
                            <span matSuffix *ngIf="unit != null">{{unit}}/ha</span>
                          </mat-form-field>
                        </ng-template>
                      </div>
                    </div>
                  </td>
                  <!--
                  <td *ngIf="!new">
                    <div class="form-group">
                      <button class="btn btn-primary btn-add mr-2" data-toggle="modal" data-target="#materialModal"
                        (click)="addDetailMaterial()">
                        <i class="fa fa-ellipsis-v"></i>
                      </button>
                    </div>
                  </td>
                  -->
                  <td>
                    <div *ngIf="new" class="form-group">
                      <button class="btn btn-primary btn-add mr-2" (click)="addMaterial(materialForm.valid)"
                      style="width: 70px !important;">
                        <i class="fa fa-plus"></i> Dodaj
                      </button>
                    </div>
                    <div *ngIf="!new" class="form-group">
                      <button class="btn btn-primary btn-add mr-2" (click)="addNewMaterial()"
                        [disabled]="workOrder.status == 'Zatvoren' || creator!=loggedUser"
                        style="width: 70px !important;">
                        <i class="fa fa-plus"></i> Dodaj
                      </button>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="7"><hr style="height:2px;border-width:0;color:gray;background-color:#33590b"></td>
                </tr>
                <tr *ngIf="new && woMaterials.length > 0">
                  <td></td>
                  <td></td>
                  <td style="text-align: right;">Potvrda izmene</td>
                  <td style="text-align: right;">Obriši</td>
                </tr>
                <tr *ngIf="!new && workOrder.materials.length > 0">
                  <td></td>
                  <td></td>
                  <td></td>
                  <td style="float: right;">Učinci</td>
                  <td style="text-align: right;">Potvrda izmene</td>
                  <td style="text-align: right;">Obriši</td>
                </tr>
                <!--editable table materials new wo-->
                <ng-container *ngIf="new; else elseBlockSpentMaterial">

                  <tr *ngFor="let material of woMaterials">
                    <td>
                      <form>
                        <!--WITH SAP ID-->
                        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWoMaterial">
                          <input type="text" matInput [(ngModel)]="material.material"
                            [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoWoMaterial" #searchWoMaterial
                            required />

                          <mat-autocomplete #autoWoMaterial="matAutocomplete" [displayWith]="displayFnMaterial" place>
                            <mat-option *ngFor="
                            let sub of (substances$ | async) | SearchMaterials: searchWoMaterial.value
                              " [value]="sub">
                              {{sub.Id}} - {{ sub.Name }}
                            </mat-option>
                          </mat-autocomplete>
                        </mat-form-field>
                        <!--WITHOUT SAP ID-->
                        <ng-template #elseBlockWoMaterial>
                          <mat-form-field class="inputAuto">
                            <input type="text" matInput [(ngModel)]="material.material"
                              [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoWoMaterialWithoutId"
                              #searchWoMaterialWithoutId required />

                            <mat-autocomplete #autoWoMaterialWithoutId="matAutocomplete"
                              [displayWith]="displayFnWithoutId" place>
                              <mat-option *ngFor="
                              let sub of (substances$ | async) | SearchMaterials: searchWoMaterialWithoutId.value
                                " [value]="sub">
                                {{ sub.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                        </ng-template>
                      </form>
                    </td>
                    <td>
                      <div class="form-group">
                        <div class="input-group mb-3">
                          <mat-form-field class="inputAuto">
                          <input [(ngModel)]="material.quantity" [ngModelOptions]="{ standalone: true }" type="number"
                            name="{{ material.quantity }}" id="" matInput />
                            <span matSuffix>{{material.material.Unit}}</span>
                        </mat-form-field>
                        </div>
                      </div>
                    </td>
                    <!--
                    <td>
                      <div class="form-group">
                        <div class="input-group mb-3">
                          <input [(ngModel)]="material.quantity / crop.Area" [ngModelOptions]="{ standalone: true }"
                            type="number" name="{{ material.quantity / crop.Area }}" id="" class="form-control"
                            disabled />
                          <div class="input-group-append">
                            <span class="input-group-text" id="basic-addon2">{{ material.material.unit }}/ha</span>
                          </div>
                        </div>
                      </div>
                    </td>
                  -->
                    <!--
                    <td>
                      <div class="form-group">
                        <button
                          class="btn btn-primary btn-add mr-2"
                          data-toggle="modal"
                          data-target="#materialModal"
                          (click)="editMaterial(material)"
                        >
                          <i class="fa fa-ellipsis-v"></i>
                        </button>
                      </div>
                    </td>
                    -->
                    <td>
                      <button style="width: max-content;" class="btn btn-primary btn-add mr-2" 
                        (click)="editExistingMaterial(material)" style="width: 80px !important;">
                        <i class="fa fa-check"></i> Sačuvaj
                      </button>
                    </td>
                    <td>
                      <div class="form-group">
                        <button class="btn btn-primary btn-delete mr-2" (click)="deleteSpentMaterial(material)">
                          <i class="fa fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <div class="col-12">
                    <div class="input-group">
                      <i *ngIf="woMaterials.length == 0">Dodajte materijale</i>
                    </div>
                  </div>
                </ng-container>
                <!--editable table materials existing wo-->
                <ng-template #elseBlockSpentMaterial>
                  <tr *ngFor="let material of workOrder.materials">
                    <ng-container *ngIf="!material.deleted">
                      <td>
                        <form>
                          <!--WITH SAP ID-->
                          <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockExDbWoMaterial">
                            <input type="text" matInput [(ngModel)]="material.material"
                              [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExDbWoMaterial"
                              #searchExDbWoMaterial required  [disabled]="material.fuel" />

                            <mat-autocomplete #autoExDbWoMaterial="matAutocomplete" [displayWith]="displayFnMaterial"
                              place>
                              <mat-option *ngFor="
                            let sub of (substances$ | async) | SearchMaterials: searchExDbWoMaterial.value
                              " [value]="sub">
                                {{sub.Id}} - {{ sub.Name }}
                              </mat-option>
                            </mat-autocomplete>
                          </mat-form-field>
                          <!--WITHOUT SAP ID-->
                          <ng-template #elseBlockExDbWoMaterial>
                            <mat-form-field class="inputAuto">
                              <input type="text" matInput [(ngModel)]="material.material"
                                [ngModelOptions]="{ standalone: true }" [matAutocomplete]="autoExDbWoMaterialWithoutId"
                                #searchExDbWoMaterialWithoutId required  [disabled]="material.fuel"/>

                              <mat-autocomplete #autoExDbWoMaterialWithoutId="matAutocomplete"
                                [displayWith]="displayFnWithoutId" place>
                                <mat-option *ngFor="
                              let sub of (substances$ | async) | SearchMaterials: searchExDbWoMaterialWithoutId.value
                                " [value]="sub">
                                  {{ sub.Name }}
                                </mat-option>
                              </mat-autocomplete>
                            </mat-form-field>
                          </ng-template>
                        </form>
                      </td>
                      <td>
                        <div class="form-group">
                          <div class="input-group mb-3">
                            <mat-form-field>
                              <input [(ngModel)]="material.quantity" [ngModelOptions]="{ standalone: true }" type="number"
                                name="{{ material.quantity }}" id="" matInput  [disabled]="material.fuel"
                                onKeyPress="if(this.value.length==7) return false;" />
                              <span matSuffix>{{material.material.Unit}}</span>
                            </mat-form-field>
                          </div>
                          <div *ngIf="validQuantity == false && clickUpdateMaterial && idForValidQuantity == material.id"
                            style="color: red">
                            Uneta količina mora biti 0 ili veća od nule.
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="form-group">
                          <div class="input-group mb-3">
                            <mat-form-field>
                              <input [(ngModel)]="material.quantity/workOrder.treated" [ngModelOptions]="{ standalone: true }" type="number"
                                name="{{ material.quantityPerHectar }}" id="" matInput disabled />
                              <span matSuffix>{{material.material.Unit}}/ha</span>
                            </mat-form-field>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="form-group">
                          <button class="btn btn-primary btn-add mr-2" data-toggle="modal" data-target="#materialModal"
                            (click)="editMaterial(material)" id="{{ material.id }}" [ngClass]="material.spent == null || 
                          material.spent == -1 ? 'warning' : 'ok'"  [disabled]="material.fuel">
                            <i class="fa fa-ellipsis-v"></i>
                          </button>
                        </div>
                      </td>
                      <td>
                        <button style="width: max-content;" class="btn btn-primary btn-add mr-2" (click)="updateMaterialBasicInfo(material)"
                          [disabled]="workOrder.status == 'Zatvoren' || creator!=loggedUser || material.fuel" style="width: 80px !important;">
                          <i class="fa fa-check"></i> Sačuvaj
                        </button>
                      </td>
                      <td>
                        <div class="form-group">
                          <button class="btn btn-primary btn-delete mr-2"
                            data-toggle="modal" 
                            data-target="#deleteMaterialModal" 
                            (click)="setMaterialId(material.id)"
                            [disabled]="workOrder.status == 'Zatvoren' || creator!=loggedUser || material.fuel">
                            <i class="fa fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </ng-container>
                  </tr>
                  <div class="col-16">
                  
                      <i *ngIf="workOrder.materials.length == 0">Dodajte materijale</i><br>
                      <i>*Polja koja su obavezna za unos</i><br>
                      <i *ngIf="!new"><span style="color: #f68901;">*</span>Polja koja će se automatski popuniti</i>
                  
                  </div>
                </ng-template>
              </tbody>
            </table>
          </div>
        </form>
      </div>
    </div>
  </div>
  <br />
  <div class="col" style="float: right;">
    <button class="btn btn-primary btn-cancellation mr-2"
      *ngIf="machines == true && materials == true && !new && creator==loggedUser && workOrder.status != 'Storniran' && workOrder.status == 'Zatvoren'" (click)="cancellationWorkOrder()">
      <i class="fa fa-ban"></i> Storniraj radni nalog
    </button>
    <button class="btn btn-primary btn-edit" style="margin-bottom: 5px; margin-right: 5px;"
      *ngIf="machines == true && materials == true && !new && workOrder.status != 'Zatvoren' && creator==loggedUser"
      data-toggle="modal" data-target="#closeWOModal">
      <i class="fa fa-check"></i> Zatvori RN i proknjiži materijal
    </button>
    <button class="btn btn-primary btn-add mr-2" style="margin-bottom: 5px;"
      *ngIf="machines == true && materials == true && !new && workOrder.status != 'Zatvoren' && creator==loggedUser"
      (click)="checkIfStartedCreation()">
      <i class="fa fa-save mr-2"></i>Sačuvaj radni nalog
    </button>

    <button class="btn btn-primary btn-add mr-2" *ngIf="new && machine && materials" style="margin-bottom: 5px;"
      (click)="addWorkOrder(infoWorkOrderForm)">
      <i class="fa fa-save mr-2"></i> Sačuvaj
    </button>
  </div>
  <br />
  <ngx-spinner></ngx-spinner>
</div>
<!--Mobile version-->
<div class="container d-md-none">
  <div class="row" style="margin-top: 80px">
    <div class="col-8" *ngIf="new">
      <h3 >Kreiranje naloga</h3>
      <span>Status: </span><span [ngClass]="{
        statusNovi: workOrder.status == 'Novi',
        statusURadu: workOrder.status == 'U radu',
        statusZatvoren: workOrder.status == 'Zatvoren'
      }">{{ workOrder.status }}</span>
    </div>
    <div class="col-6" *ngIf="!new">
      <h3>Informacije o nalogu</h3>
      <span>Status: </span><span [ngClass]="{
          statusNovi: workOrder.status == 'Novi',
          statusURadu: workOrder.status == 'U radu',
          statusZatvoren: workOrder.status == 'Zatvoren'
        }">{{ workOrder.status }}</span>
        <br>
          <span>Br. RN (SAP): {{workOrder.sapId}}</span><br>
          <span>RN kreirao/la: {{userCreator.name}} {{userCreator.surname}}</span>
    </div>
    <div class="col" *ngIf="new">
      <div class="btn-group-vertical" style="float: right">
        
        <button class="btn btn-primary btn-add mr-2" *ngIf="new" (click)="addWorkOrder(workOrderInfoMobForm)">
          <i class="fa fa-save mr-2"></i> Sačuvaj
        </button>
      </div>
    </div>
    <div class="col" *ngIf="!new">
      <div *ngIf="!new" class="btn-group-vertical" style="float: right;">
        <button class="btn btn-primary btn-add mr-2" [disabled]="workOrder.status == 'Zatvoren'" *ngIf="!new"
        (click)="updateWorkOrder()">
        <i class="fa fa-save mr-2"></i>Sačuvaj RN
      </button>
        <button class="btn btn-primary btn-edit mb-2" [disabled]="workOrder.status == 'Zatvoren'" *ngIf="!new"
        data-toggle="modal" data-target="#closeWOModal" style="margin-top: 5px;">
        <i class="fa fa-check mr-2"></i>Zatvori RN
      </button>
      <button class="btn btn-primary btn-cancellation mr-2"
        *ngIf="!new && creator==loggedUser && workOrder.status != 'Storniran' && workOrder.status == 'Zatvoren'" 
        data-toggle="modal" data-target="#cancellationWorkOrderModal">
        <i class="fa fa-ban"></i> Storniraj RN
      </button>
      <button class="btn btn-danger" data-toggle="modal" data-target="#errorsModal"
        style="float: right; border: none; margin-top: 5px;" *ngIf="error">
        <i class="fa fa-exclamation-triangle"></i>
      </button>
      
      </div>
    </div>
  </div>
  <hr class="solid" />
  <form #workOrderInfoMobForm="ngForm" [ngClass]="workOrder.status == 'Zatvoren' || workOrder.status == 'Storniran' ? 'disableAll' : null">
    <div class="row" style="margin-top: 10px">
      <!--Datum-->
      <div class="col-4" style="vertical-align: bottom;">
        <i class="fa fa-calendar mr-2" style="vertical-align: middle"></i>Datum radnog naloga:
      </div>
      <div class="col-8">
        <div class="input-group mb-3">
        <input [(ngModel)]="workOrder.date" id="from" ngbDatepicker #odMob="ngbDatepicker"
          (click)="odMob.toggle()" class="form-control" name="dateFrom" #dateFromMob="ngModel" required />
          <div class="input-group-append">
            <button class="btn btn-outline-secondary calendar" (click)="odMob.toggle()" type="button"></button>
          </div>
        </div>
        <div *ngIf="dateFromMob.invalid && clickAddWorkOrder" style="color: red">
          Izaberite datum.
        </div>
      </div>
    
    </div>
    <div class="row mt-2">
       <!--Godina-->
       <div class="col-4" style="margin-top: 7px;"><i class="fa fa-calendar-check-o"></i>Godina:</div>
       <div class="col-8">
        <select name="year" [(ngModel)]="workOrder.year" id="" class="form-control"
        *ngIf="!new; else elseBlockYearMob" (change)="getCulture()">
        <option value="{{previousYear}}">{{previousYear}}</option>
        <option value="{{currentYear}}" selected>{{currentYear}}</option>
        <option value="{{nextYear}}">{{nextYear}}</option>
      </select>
      <ng-template #elseBlockYearMob>
        <select name="selYear" [(ngModel)]="selectedYear" id="" class="form-control" #yearMob="ngModel"
          required (change)="getCulture()">
          <option value="{{previousYear}}">{{previousYear}}</option>
          <option value="{{currentYear}}" selected>{{currentYear}}</option>
          <option value="{{nextYear}}">{{nextYear}}</option>
        </select>
        <div *ngIf="yearMob.invalid && clickAddWorkOrder" style="color: red; font-weight: normal">
          Izaberite godinu.
        </div>
      </ng-template>
    </div>
      
    </div>
    <hr class="solid" />
    <div class="row mt-2">
      <!--Parcela-->
      <div class="col-4">
        <i class="fa fa-map-marker mr-2" style="margin-top: 17px;"></i>Parcela:
      </div>
      <div class="col-8">
        <form>
          <!--WITH SAP ID-->
          <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockFieldMob">
            <input type="text" matInput [formControl]="fieldFC" [matAutocomplete]="autoFieldMob" #searchField required
              placeholder="Izaberite parcelu" />

            <mat-autocomplete #autoFieldMob="matAutocomplete" [displayWith]="displayFnField" place>
              <mat-option *ngFor="
                  let field of fields | SearchFields: searchField.value
                " [value]="field" (click)="getCulture()">
                {{field.Id}} - {{ field.Name }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <!--WITHOUT SAP ID-->
          <ng-template #elseBlockFieldMob>
            <mat-form-field class="inputAuto">
              <input type="text" matInput [formControl]="fieldFC" [matAutocomplete]="autoFieldWithoutIdMob"
                #searchFieldWithoutId required placeholder="Izaberite parcelu" />

              <mat-autocomplete #autoFieldWithoutIdMob="matAutocomplete" [displayWith]="displayFnWithoutId" place>
                <mat-option *ngFor="
                    let field of fields | SearchFields: searchFieldWithoutId.value
                  " [value]="field" (click)="getCulture()">
                  {{ field.Name }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </ng-template>
          <div *ngIf="fieldFC.invalid && clickAddWorkOrder" style="color: red; font-weight: normal">
            Izaberite parcelu.
          </div>
        </form>
      </div>
      
    </div>
    <div class="row mt-2">
        <!--Usev-->
        <div class="col-4" style="margin-top: 17px;"><i class="fa fa-cubes"></i> Usev:</div>
        <div class="col-8">
          <form>
            <!--WITH SAP ID-->
            <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockCultureMob">
              <input type="text" matInput [formControl]="cultureFC" [matAutocomplete]="autoCultureMob" #searchCulture
                required placeholder="Izaberite usev, nakon što izaberete parcelu" />

              <mat-autocomplete #autoCultureMob="matAutocomplete" [displayWith]="displayFnCulture" place>
                <mat-option *ngFor="
                  let crop of crops | SearchCultures: searchCulture.value
                  " [value]="crop" (click)="getArea(crop.id)">
                  {{crop.Id}} - {{ crop.Name }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <!--WITHOUT SAP ID-->
            <ng-template #elseBlockCultureMob>
              <mat-form-field class="inputAuto">
                <input type="text" matInput [formControl]="cultureFC" [matAutocomplete]="autoCultureWithoutIdMob"
                  #searchCultureWithoutId required placeholder="Izaberite usev, nakon što izaberete parcelu" />

                <mat-autocomplete #autoCultureWithoutIdMob="matAutocomplete" [displayWith]="displayFnCultureWithoutId"
                  place>
                  <mat-option *ngFor="
                    let crop of crops | SearchCultures: searchCultureWithoutId.value
                    " [value]="crop" (click)="getArea(crop.id)">
                    {{ crop.Name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </ng-template>
            <div *ngIf="cultureFC.valid == false && clickAddWorkOrder" style="color: red; font-weight: normal">
              Izaberite usev.
            </div>
          </form>
        </div>
      
    </div>
    <hr class="solid" />
    <div class="row mt-2">
      <!--ATM-->
      <div class="col-4">
        <i class="fa fa-file mr-2" style="margin-top: 17px;"></i>
          ATM:
      </div>
      <div class="col-8">
        <form>
          <!--WITH SAP ID-->
          <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockOpMob">
            <input type="text" matInput [formControl]="operationFC" [matAutocomplete]="autoOpMob" #searchOp required
              placeholder="Izaberite agrotehničku meru" />

            <mat-autocomplete #autoOpMob="matAutocomplete" [displayWith]="displayFnOperation" place>
              <mat-option *ngFor="
                  let op of operations | SearchOperations: searchOp.value
                " [value]="op" (click)="getOperation(op)">
                {{op.Id}} - {{ op.Name }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <!--WITHOUT SAP ID-->
          <ng-template #elseBlockOpMob>
            <mat-form-field class="inputAuto">
              <input type="text" matInput [formControl]="operationFC" [matAutocomplete]="autoOpWithoutIdMob"
                #searchOpWithoutId required placeholder="Izaberite agrotehničku meru" />

              <mat-autocomplete #autoOpWithoutIdMob="matAutocomplete" [displayWith]="displayFnWithoutId" place>
                <mat-option *ngFor="
                    let op of operations | SearchOperations: searchOpWithoutId.value
                  " [value]="op" (click)="getOperation(op)">
                  {{ op.Name }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </ng-template>
          <div *ngIf="operationFC.invalid && clickAddWorkOrder" style="color: red; font-weight: normal">
            Izaberite agrotehničku meru.
          </div>
        </form>
      </div>
    </div>
    <div class="row mt-2">
     <!--Odgovorna osoba-->
     <div class="col-4" style="margin-top: 3%">
      <i class="fa fa-user mr-2"></i>Odgovorna osoba:
    </div>
    <div class="col-8">
      <form>
        <!--WITH SAP ID-->
        <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockResponsibleMob">
          <input type="text" matInput [formControl]="nameFC" [matAutocomplete]="autoMob" #search style="width: 100%"
            required placeholder="Izaberite odgovornu osobu" />

          <mat-autocomplete #autoMob="matAutocomplete" [displayWith]="displayFn" place>
            <mat-option *ngFor="
                let emp of allEmployees | SearchEmployees: search.value
              " [value]="emp">
              {{emp.perNumber}} - {{ emp.name }}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
        <!--WITHOUT SAP ID-->
        <ng-template #elseBlockResponsibleMob>
          <mat-form-field class="inputAuto">
            <input type="text" matInput [formControl]="nameFC" [matAutocomplete]="autoWithoutIdMob" #searchWithoutId
              required placeholder="Izaberite odgovornu osobu" />

            <mat-autocomplete #autoWithoutIdMob="matAutocomplete" [displayWith]="displayFnResponsible" place>
              <mat-option *ngFor="
                  let emp of allEmployees | SearchEmployees: searchWithoutId.value
                " [value]="emp">
                {{ emp.name }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
        </ng-template>
        <div *ngIf="nameFC.valid == false && clickAddWorkOrder" style="color: red; font-weight: normal">
          Izaberite odgovornu osobu.
        </div>
      </form>
    </div>
    </div>
    <hr class="solid" />
    <div class="row mt-2">
      <div class="col-4" style="margin-top: 7px;"><i class="fa fa-slack mr-2"></i>Broj referentnog naloga:</div>
      <div class="col-8">
        <form>
          <mat-form-field class="inputAuto">
            <input matInput type="text" name="numberOfReferenceOrder" [formControl]="numOfRefOrderFC"
              placeholder="Unesite broj referentnog naloga, ukoliko želite" maxlength="40">
          </mat-form-field>
        </form>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-4" style="margin-top: 15px;"><i class="fa fa-comment mr-2"></i>Napomena:</div>
      <div class="col-8">
        <form>
          <mat-form-field class="inputAuto">
            <input matInput type="text" name="note" [formControl]="noteFC" placeholder="Unesite napomenu, ukoliko želite" maxlength="40">
          </mat-form-field>
        </form>
      </div>
    </div>
    <hr class="solid" />
    <div class="row mt-2" >
      <!--Povrsina-->
      <div class="col-4" style="margin-top: 7px;"><i class="fa fa-clone"></i> Površina:</div>
      <div class="col-8">
        <div class="input-group">
          <input type="text" name="area" [(ngModel)]="workOrder.area" id="" class="form-control" #area="ngModel"
            required disabled />
          <div class="input-group-append">
            <span class="input-group-text" id="basic-addon2">ha</span>
          </div>
        </div>
        <div *ngIf="area.invalid && clickAddWorkOrder" style="color: red">
          Unesite površinu.
        </div>
      </div>
    </div>
    <div class="row mt-2">
      <!--Obradjeno-->
      <div class="col-4" style="margin-top: 5px;">
        <span *ngIf="!new"><i class="fa fa-flag mr-2"></i>Obrađeno:</span>
      </div>
      <div class="col-8">
        
          <div class="input-group mb-3" *ngIf="!new">
            <div class="input-group-prepend">
              <div class="input-group-text">
                <input *ngIf="workOrder.noOperationOutput" checked type="checkbox" [(ngModel)]="noOperationOutput" name="noOpOutput" [ngModelOptions]="{standalone: true}" (click)="disableTreated()">
                <input *ngIf="!workOrder.noOperationOutput" type="checkbox" [(ngModel)]="noOperationOutput" name="noOpOutput" [ngModelOptions]="{standalone: true}" (click)="disableTreated()">
              </div>
            </div>
            <input type="number" onKeyPress="if(this.value.length==6) return false;" name="treated"
              [(ngModel)]="treatedEntered" id="" class="form-control" (change)="calculateQuantityPerHectar()" [disabled]="noOperationOutput" />
            <div class="input-group-append">
              <span class="input-group-text" id="basic-addon2">ha</span>
            </div>
          </div>
          <i *ngIf="!new" style="color: black; opacity: 70%; margin-bottom: 0px; font-size: smaller;">
            *Čekirajte ukoliko je radni nalog opšti.
          </i>
          <div *ngIf="validWoInfo == false && clickCloseWorkOrder" style="color: red; font-weight: normal">
            Unesite površinu.
          </div>
          <div *ngIf="validTreated == false && clickUpdateWo" style="color: red; font-weight: normal">
            Površina mora biti veća ili jednaka nuli.
          </div>
       
      </div>
    </div>
  </form>
  <hr class="solid" />
  <div class="workers" >
    <button class="btn btn-primary collapsing-button shadow-none" (click)="expandWorkers()" type="button"
      data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
      <i class="fa fa-user mr-2"></i>
      <i class="fa fa-truck mr-2"></i>
        Izvršioci/Mašine
        <i *ngIf="!workers" class="fa fa-arrow-down mr-2 mt-1 arrows" data-toggle="collapse" 
        data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"></i>
        <i *ngIf="workers" class="fa fa-arrow-up mr-2 mt-1 arrows" data-toggle="collapse" 
        data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"></i>
    </button>
    <div class="collapse" id="collapseExample" [ngClass]="workOrder.status == 'Zatvoren' || workOrder.status == 'Storniran' ? 'disableAll' : null">
      <div class="card card-body collapse-card">
        <div class="col-12">
          <button class="btn btn-primary" style="float: right; margin-top: 5px; background-color: #5c7495; border: none"
            data-toggle="modal" data-target="#exampleModal" (click)="addNewWowMob()">
            <i class="fa fa-plus mr-2"></i>Dodaj izvršioca/mašinu
          </button>
        </div>
        <br />
        <ng-container *ngIf="new; else elseBlockMachineStateMob">
          <div *ngFor="let wow of wows" class="card mb-3" style="border: 1px solid #5c7495; border-radius: 5px">
            <div id="rad"></div>
            <div class="card-body">
              <h5 class="card-title">{{wow.user.name}} </h5>
              <ul class="list-group">
                <li class="list-group-item list-group-item-info">
                  <div class="row">
                    <div class="col-1">
                      <i class="fa fa-file mr-2"></i>
                    </div>
                    <div class="col">
                      <b>ATM:</b> {{wow.operation.Name}}
                    </div>
                  </div>
                </li>
                <li class="list-group-item list-group-item-info">
                  <div class="row">
                    <div class="col-1">
                      <i class="fa fa-truck" ></i>
                    </div>
                    <div class="col">
                      <b>Mašina:</b> {{wow.machine.Name}}
                    </div>
                  </div>
                </li>
                <li class="list-group-item list-group-item-info">
                  <div class="row">
                    <div class="col-1">
                      <i class="fa fa-truck" ></i>
                    </div>
                    <div class="col">
                      <span *ngIf="wow.connectingMachine.dbid == -1">
                        <b>Priključna mašina:</b> BEZ PRIKLJUČNE MAŠINE 
                      </span>
                      <span *ngIf="wow.connectingMachine.dbid != -1">
                        <b>Priključna mašina:</b> {{wow.connectingMachine.Name}} 
                      </span>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="card-footer" style="background-color: #acbacc3a">
              <button class="btn btn-secondary btn-delete" style="float: right" (click)="deleteWorkOrderWorker(wow)">
                <i class="fa fa-trash mr-2"></i>Obriši
              </button>
              <button class="btn btn-secondary btn-edit" style="float: right; margin-right: 5px;" data-toggle="modal" data-target="#exampleModal"
                (click)="editWow(wow)">
                <i class="fa fa-edit mr-2"></i>Izmeni
              </button>
              
            </div>
          </div>
        </ng-container>
        <ng-template #elseBlockMachineStateMob>
          <div *ngFor="let wow of workOrder.workers" class="card mb-3" style="border: 1px solid #5c7495; border-radius: 5px">
            <div id="rad"></div>
            <div class="card-body">
              <h5 class="card-title">{{wow.user.Name}} </h5>
              <ul class="list-group">
                <li class="list-group-item list-group-item-info">
                  <div class="row">
                    <div class="col-1">
                      <i class="fa fa-file mr-2"></i>
                    </div>
                    <div class="col">
                      <b>ATM:</b> {{wow.operation.Name}}
                    </div>
                  </div>
                </li>
                <li class="list-group-item list-group-item-info">
                  <div class="row">
                    <div class="col-1">
                      <i class="fa fa-truck" ></i>
                    </div>
                    <div class="col">
                      <b>Mašina:</b> {{wow.machine.Name}}
                    </div>
                  </div>
                </li>
                <li class="list-group-item list-group-item-info">
                  <div class="row">
                    <div class="col-1">
                      <i class="fa fa-truck" ></i>
                    </div>
                    <div class="col">
                      <span *ngIf="wow.connectingMachine.dbid == -1">
                        <b>Priključna mašina:</b> BEZ PRIKLJUČNE MAŠINE 
                      </span>
                      <span *ngIf="wow.connectingMachine.dbid != -1">
                        <b>Priključna mašina:</b> {{wow.connectingMachine.Name}} 
                      </span>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="card-footer" style="background-color: #acbacc3a">
              <div class="btn-group-horizontal">
                <button class="btn btn-secondary btn-delete" style="float: right" data-toggle="modal" data-target="#deleteWorkerModal" (click)="setWowId(wow.id)">
                <i class="fa fa-trash mr-2"></i>Obriši
              </button>
              <button class="btn btn-secondary btn-edit" style="float: right; margin-right: 5px; background-color: #ffc803;" data-toggle="modal" data-target="#exampleModal"
                (click)="editWow(wow)">
                <i class="fa fa-edit mr-2"></i>Izmeni
              </button>
              <button *ngIf="wow.machine.Id=='BEZ-MASINE'" class="btn btn-primary btn-add mr-2" data-toggle="modal"
                data-target="#workerMachineModal" (click)="editWorkerAndMachine(wow)" id="{{ wow.id }}"
                [ngClass]="wow.dayPeriod == null || wow.nightPeriod == null || wow.dayPeriod == -1 || wow.nightPeriod == -1 ? 
                  'warning' : 'ok'">
                <i class="fa fa-ellipsis-v"></i> Učinci
              </button>
              <button *ngIf="wow.machine.Id!='BEZ-MASINE'" class="btn btn-primary btn-add mr-2" data-toggle="modal"
                data-target="#workerMachineModal" (click)="editWorkerAndMachine(wow)" id="{{ wow.id }}"
                [ngClass]="wow.dayPeriod == null || 
                    wow.nightPeriod == null || wow.initialState == null || wow.finalState == null || 
                    wow.fuel == null || wow.dayPeriod == -1 || wow.nightPeriod == -1 || 
                    wow.initialState == -1 || wow.finalState == -1 || wow.fuel == -1 ? 
                    'warning' : 'ok'">
                <i class="fa fa-ellipsis-v"></i> Učinci
              </button>
              
            </div>
            </div>
          </div>
        </ng-template>
        
      </div>
    </div>
  </div>
  <!--
  <div class="machines mt-4">
    <button class="btn btn-primary collapsing-button shadow-none" (click)="expandMachines()" type="button"
      data-toggle="collapse" data-target="#collapseExampleMachines" aria-expanded="false"
      aria-controls="collapseExampleMachines">
      <i class="fa fa-truck mr-2"></i>Mašine<i *ngIf="!machines" class="fa fa-arrow-down mr-2 mt-1 arrows"></i><i
        *ngIf="machines" class="fa fa-arrow-up mr-2 mt-1 arrows"></i>
    </button>
    <div class="collapse" id="collapseExampleMachines">
      <div class="card card-body collapse-card">
        <div class="col-12">
          <button class="btn btn-primary" style="float: right; margin-top: 5px; background-color: #5c7495"
            data-toggle="modal" data-target="#machineModal">
            <i class="fa fa-plus mr-2"></i>Nova mašina
          </button>
        </div>
        <br />
        <div class="card mb-3" style="border: 1px solid #5c7495; border-radius: 5px">
          <div id="mas"></div>
          <div class="card-body">
            <h5 class="card-title"></h5>
            <ul class="list-group">
              <li class="list-group-item list-group-item-info">
                <i class="fa fa-suitcase" style="font-size: 20px; vertical-align: bottom"></i>
                <span style="padding-left: 2px; vertical-align: middle">
                  Radnik:
                </span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-clock-o" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Početno stanje MČ: mh
                </span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-clock-o" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Krajnje stanje MČ: mh</span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-plus" style="font-size: 20px"></i>
                <span style="padding-left: 6px">Utrošeni MČ: h
                </span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-gas-pump" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Utrošak goriva: l</span>
              </li>
            </ul>
          </div>
          <div class="card-footer" style="background-color: #acbacc3a">
            <button class="btn btn-secondary" style="float: right" data-toggle="modal" data-target="#machineModal">
              <i class="fa fa-edit mr-2"></i>Izmeni
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  -->
  <div class="machines mt-4" >
    <button class="btn btn-primary collapsing-button shadow-none" (click)="expandMaterials()" type="button"
      data-toggle="collapse" data-target="#collapseExampleMaterials" aria-expanded="false"
      aria-controls="collapseExampleMaterials">
      <i class="fa fa-leaf mr-2"></i>Materijali
      <i *ngIf="!materials" class="fa fa-arrow-down mr-2 mt-1 arrows" data-toggle="collapse" 
      data-target="#collapseExampleMaterials" aria-expanded="false" aria-controls="collapseExampleMaterials"></i>
      <i *ngIf="materials" class="fa fa-arrow-up mr-2 mt-1 arrows" data-toggle="collapse" 
      data-target="#collapseExampleMaterials" aria-expanded="false" aria-controls="collapseExampleMaterials"></i>
    </button>
    <div class="collapse" id="collapseExampleMaterials" [ngClass]="workOrder.status == 'Zatvoren' || workOrder.status == 'Storniran' ? 'disableAll' : null">
      <div class="card card-body collapse-card">
        <div class="col-12">
          <button class="btn btn-primary" style="float: right; margin-top: 5px; background-color: #5c7495; border:none"
            data-toggle="modal" data-target="#materialModalMob" (click)="addNewMaterialMob()">
            <i class="fa fa-plus mr-2"></i>Dodaj materijal
          </button>
        </div>
        <br />
        <ng-container *ngIf="new; else elseBlockMaterialsMob">
        <div class="card mb-3" *ngFor="let material of woMaterials; let i = index"
          style="border: 1px solid #5c7495; border-radius: 5px">
          <div *ngIf="i == 0" id="mat"></div>
          <div class="card-body">
            <h5 class="card-title">{{ material.material.Name }}</h5>
            <ul class="list-group">
              <li class="list-group-item list-group-item-info">
                <i class="fa fa-sort-amount-asc" style="font-size: 20px; vertical-align: bottom"></i>
                <span style="padding-left: 3px; vertical-align: middle">
                  Planirana količina: {{ material.quantity }}
                  {{ material.material.Unit }}</span>
              </li>
              <!--
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-plus" style="font-size: 20px"></i>
                <span style="padding-left: 6px">Utrošeno / ha: {{ material.spent / workOrder.area }}
                  {{ material.unit }}/ha</span>
              </li>
              <li class="list-group-item list-group-item-info" *ngIf="!new">
                <i class="fa fa-gas-pump" style="font-size: 20px"></i>
                <span style="padding-left: 3px">
                  Utrošeno: {{ material.spent || 0 }} {{ material.unit }}</span>
              </li>
              -->
            </ul>
          </div>
          <div class="card-footer" style="background-color: #acbacc3a">
            <button class="btn btn-secondary btn-delete" style="float: right;" (click)="deleteSpentMaterial(material)">
            <i class="fa fa-trash mr-2"></i>Obriši
          </button>
            <button class="btn btn-secondary btn-edit" style="float: right; margin-right: 5px;" data-toggle="modal" data-target="#materialModalMob"
              (click)="editMaterialMob(material)">
              <i class="fa fa-edit mr-2"></i>Izmeni
            </button>
          </div>
        </div>
      </ng-container>
      <ng-template #elseBlockMaterialsMob>
        <div class="card mb-3" *ngFor="let material of workOrder.materials; let i = index"
        style="border: 1px solid #5c7495; border-radius: 5px">
        <div *ngIf="i == 0" id="mat"></div>
        <div class="card-body">
          <h5 class="card-title">{{ material.material.Name }}</h5>
          <ul class="list-group">
            <li class="list-group-item list-group-item-info">
              <i class="fa fa-sort-amount-asc" style="font-size: 20px; vertical-align: bottom"></i>
              <span style="padding-left: 3px; vertical-align: middle">
                Planirana količina: {{ material.quantity }}
                {{ material.material.Unit }}</span>
            </li>
            <!--
            <li class="list-group-item list-group-item-info" *ngIf="!new">
              <i class="fa fa-plus" style="font-size: 20px"></i>
              <span style="padding-left: 6px">Utrošeno / ha: {{ material.spent / workOrder.area }}
                {{ material.unit }}/ha</span>
            </li>
            <li class="list-group-item list-group-item-info" *ngIf="!new">
              <i class="fa fa-gas-pump" style="font-size: 20px"></i>
              <span style="padding-left: 3px">
                Utrošeno: {{ material.spent || 0 }} {{ material.unit }}</span>
            </li>
            -->
          </ul>
        </div>
        <div class="card-footer" style="background-color: #acbacc3a">
          <button *ngIf="!material.fuel" class="btn btn-primary btn-delete mr-2"
            data-toggle="modal" data-target="#deleteMaterialModal" (click)="setMaterialId(material.id)"
            [disabled]="workOrder.status == 'Zatvoren' || creator!=loggedUser || material.fuel">
              <i class="fa fa-trash"></i> Obriši
          </button>
          <button *ngIf="!material.fuel" class="btn btn-secondary btn-edit" style="float: right; margin-right: 5px; background-color: #ffc803;" data-toggle="modal" data-target="#materialModalMob"
            (click)="editMaterialMob(material)">
            <i class="fa fa-edit mr-2"></i>Izmeni
          </button>
          <button *ngIf="!material.fuel" class="btn btn-primary btn-add mr-2" data-toggle="modal" data-target="#materialModal"
            (click)="editMaterial(material)" id="{{ material.id }}" [ngClass]="material.spent == null || 
            material.spent == -1 ? 'warning' : 'ok'">
          <i class="fa fa-ellipsis-v"></i> Učinci
        </button>
          <i *ngIf="material.fuel" style="font-size: small;">*Automatski dodato gorivo se ne može menjati</i>

        </div>
      </div>
      </ng-template>
      </div>
    </div>
  </div>
  <ngx-spinner></ngx-spinner>
</div>

<!-- Modal new worker/machine mob -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 *ngIf="!editWowMobFlag" class="modal-title" id="exampleModalLabel">
          Dodavanje izvršioca/mašine
        </h5>
        <h5 *ngIf="editWowMobFlag" class="modal-title" id="exampleModalLabel">
          Izmena izvršioca/mašine
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeButtonWorkerModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #workerModalForm="ngForm">
          <div class="form-group">
            <label for="imePrz">Izvršioc</label>
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorkerMob">
                <input type="text" matInput [formControl]="workerFC" [matAutocomplete]="autoWorkerMob"
                  #searchWorkerMob required placeholder="Izaberite izvršioca" />

                <mat-autocomplete #autoWorkerMob="matAutocomplete" [displayWith]="displayFn" place>
                  <mat-option *ngFor="
                    let emp of allEmployees | SearchEmployees: searchWorkerMob.value
                  " [value]="emp">
                    {{emp.perNumber}} - {{ emp.name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockWorkerMob>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="workerFC" [matAutocomplete]="autoWorkerWithoutIdMob"
                    #searchWorkerWithoutIdMob required placeholder="Izaberite izvršioca" />

                  <mat-autocomplete #autoWorkerWithoutIdMob="matAutocomplete" [displayWith]="displayFnResponsible"
                    place>
                    <mat-option *ngFor="
                      let emp of allEmployees | SearchEmployees: searchWorkerWithoutIdMob.value
                    " [value]="emp">
                      {{ emp.name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="workerFC.invalid && clickAddWorkerMachine == true"
                style="color: red; font-weight: normal; text-align: left;">
                Izvršioc je obavezno polje.<br> Popunite ga.
              </div>
            </form>
          </div>
          <div class="form-group">
            <label for="imePrz">ATM</label>
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorkerOpMob">
                <input type="text" matInput [formControl]="workerOperationFC" [matAutocomplete]="autoWorkerOpMob"
                  #searchWorkerOpMob required placeholder="Izaberite agrotehničku meru" />

                <mat-autocomplete #autoWorkerOpMob="matAutocomplete" [displayWith]="displayFnOperation" place>
                  <mat-option *ngFor="
                      let op of operations | SearchOperations: searchWorkerOpMob.value
                    " [value]="op">
                    {{ op.Id }} - {{ op.Name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockWorkerOpMob>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="workerOperationFC"
                    [matAutocomplete]="autoWorkerOpWithoutIdMob" #searchWorkerOpWithoutIdMob required
                    placeholder="Izaberite agrotehničku meru" />

                  <mat-autocomplete #autoWorkerOpWithoutIdMob="matAutocomplete" [displayWith]="displayFnWithoutId"
                    place>
                    <mat-option *ngFor="
                        let op of operations | SearchOperations: searchWorkerOpWithoutIdMob.value
                      " [value]="op">
                      {{ op.Name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="workerOperationFC.invalid && clickAddWorkerMachine == true"
                style="color: red; font-weight: normal; text-align: left;">
                ATM je obavezno polje.<br>Popunite ga.
              </div>
            </form>
          </div>
          <div class="form-group">
            <label for="imePrz">Mašina</label>
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorkerMachineMob">
                <input type="text" matInput [formControl]="workerMachineFC"
                  [matAutocomplete]="autoWorkerMachineMob" #searchWorkerMachineMob required
                  placeholder="Izaberite mašinu" />

                <mat-autocomplete #autoWorkerMachineMob="matAutocomplete" [displayWith]="displayFnMachine" place>
                  <mat-option *ngFor="
                  let dev of devicesPropulsion | SearchPropulsionMachines: searchWorkerMachineMob.value
                    " [value]="dev">
                    {{dev.Id}} - {{ dev.Name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockWorkerMachineMob>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="workerMachineFC"
                    [matAutocomplete]="autoWorkerMachineWithoutIdMob" #searchWorkerMachineWithoutIdMob required
                    placeholder="Izaberite mašinu" />

                  <mat-autocomplete #autoWorkerMachineWithoutIdMob="matAutocomplete"
                    [displayWith]="displayFnMachineWithoutId" place>
                    <mat-option *ngFor="
                    let dev of devicesPropulsion | SearchPropulsionMachines: searchWorkerMachineWithoutIdMob.value
                      " [value]="dev">
                      {{ dev.Name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="workerMachineFC.invalid && clickAddWorkerMachine == true"
                style="color: red; font-weight: normal; text-align: left;">
                Mašina je obavezno polje.<br>Popunite ga.
              </div>
            </form>
          </div>
          <div class="form-group">
            <label for="imePrz">Priključna mašina</label>
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockWorkerCoMachineMob">
                <input type="text" matInput [formControl]="workerCoMachineFC"
                  [matAutocomplete]="autoWorkerCoMachineMob" #searchWorkerCoMachineMob required
                  placeholder="Izaberite priključnu mašinu" />

                <mat-autocomplete #autoWorkerCoMachineMob="matAutocomplete" [displayWith]="displayFnMachine" place>
                  <mat-option [value]="-1">
                    BEZ PRIKLJUČNE MAŠINE
                  </mat-option>
                  <mat-option *ngFor="
                  let dev of devicesCoupling | SearchCouplingMachines: searchWorkerCoMachineMob.value
                    " [value]="dev">
                    {{dev.Id}} - {{ dev.Name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockWorkerCoMachineMob>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="workerCoMachineFC"
                    [matAutocomplete]="autoWorkerCoMachineWithoutIdMob" #searchWorkerCoMachineWithoutIdMob required
                    placeholder="Izaberite priključnu mašinu" />

                  <mat-autocomplete #autoWorkerCoMachineWithoutIdMob="matAutocomplete"
                    [displayWith]="displayFnMachineWithoutId" place>
                    <mat-option [value]="-1">
                      BEZ PRIKLJUČNE MAŠINE
                    </mat-option>
                    <mat-option *ngFor="
                    let dev of devicesCoupling | SearchCouplingMachines: searchWorkerCoMachineWithoutIdMob.value
                      " [value]="dev">
                      {{ dev.Name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="workerCoMachineFC.invalid && clickAddWorkerMachine == true"
                style="color: red; font-weight: normal; text-align: left;">
                Priključna mašina je obavezno polje.<br>Popunite ga.
              </div>
            </form>
          </div>
          <!--
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Datum</label>
            <div class="input-group">
              <input [(ngModel)]="workOrder.date" name="dat" (click)="od.toggle()" class="form-control" id="od"
                placeholder="yyyy-mm-dd" ngbDatepicker #od="ngbDatepicker" />
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="od.toggle()" type="button"></button>
              </div>
            </div>
          </div>
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Redovan rad</label>
            <div class="input-group mb-3">
              <input [(ngModel)]="wow.dayPeriod" type="number" name="dayWP" class="form-control" id="" />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">h</span>
              </div>
            </div>
          </div>
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Noćni rad</label>
            <div class="input-group mb-3">
              <input [(ngModel)]="wow.nightPeriod" type="number" name="nightWP" class="form-control" id="" />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">h</span>
              </div>
            </div>
          </div>
          <div class="form-group" *ngIf="!new">
            <label for="imePrz">Ukupan rad</label>
            <div class="input-group mb-3">
              <input type="number" name="sumHours" class="form-control" id="" readonly />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">h</span>
              </div>
            </div>
          </div>
          -->
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" style="background-color: #f68901">
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button *ngIf="!editWowMobFlag && new" type="button" class="btn btn-success" style="background-color: #33590b"
          (click)="addWorkerAndMachine(workerModalForm.valid)">
          <i class="fa fa-save"></i> Dodaj
        </button>
        <button *ngIf="!editWowMobFlag && !new" type="button" class="btn btn-success" style="background-color: #33590b"
          (click)="addNewWorkerAndMachine()">
          <i class="fa fa-save"></i> Dodaj
        </button>
        <button *ngIf="editWowMobFlag && new" type="button" class="btn btn-success" style="background-color: #33590b"
          (click)="editExistingWorkerAndMachine(wowMob)">
        <i class="fa fa-save"></i> Sačuvaj 
      </button>
      <button *ngIf="editWowMobFlag && !new" type="button" class="btn btn-success" style="background-color: #33590b"
          (click)="updateWOWBasicInfo(wowMob)">
        <i class="fa fa-save"></i> Sačuvaj 
      </button>
      </div>
    </div>
  </div>
</div>

<!-- Machine Modal -->
<div class="modal fade" id="machineModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          {{ headerMachine }}
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeButtonMachineModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #machineModalForm="ngForm">
          <div class="form-group">
            <label for="masina">Mašina</label>
            <select name="masina" id="masina" class="form-control" [(ngModel)]="selectedMachine" #machine="ngModel"
              required>
              <option value="-1">
                //dodaj masine
              </option>
            </select>
            <div *ngIf="machine.invalid && clickAddMachine" style="color: red">
              Izaberite mašinu.
            </div>
          </div>
          <div class="form-group">
            <label for="rad">Radnik</label>
            <select name="rad" id="rad" class="form-control" [(ngModel)]="selectedWorkerForMachine"
              #machineWorker="ngModel" required>
              <option value="{{ emp.userId }}&{{ emp.name }}" *ngFor="let emp of allEmployees">
                {{ emp.name }}
              </option>
            </select>
            <div *ngIf="machineWorker.invalid && clickAddMachine" style="color: red">
              Izaberite radnika.
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" style="background-color: #f68901">
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button type="button" class="btn btn-success" style="background-color: #33590b">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
<!--Material modal mob-->
<div class="modal fade" id="materialModalMob" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          {{ headerMaterial }}
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeButtonMaterialModalMob>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #materialModalMobForm="ngForm">
          <div class="form-group">
            <label for="materijal">Materijal</label>
            <form>
              <!--WITH SAP ID-->
              <mat-form-field class="inputAuto" *ngIf="sapId == 'WITH_ID'; else elseBlockMaterialMob">
                <input type="text" matInput [formControl]="materialFC" [matAutocomplete]="autoMaterialMob"
                  #searchMaterialMob required placeholder="Izaberite materijal" />

                <mat-autocomplete #autoMaterialMob="matAutocomplete" [displayWith]="displayFnMaterial" place>
                  <mat-option *ngFor="
                  let sub of (substances$ | async) | SearchMaterials: searchMaterialMob.value
                    " [value]="sub" (click)="getUnitOfMaterial(sub.dbid)">
                    {{sub.Id}} - {{ sub.Name }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!--WITHOUT SAP ID-->
              <ng-template #elseBlockMaterialMob>
                <mat-form-field class="inputAuto">
                  <input type="text" matInput [formControl]="materialFC"
                    [matAutocomplete]="autoMaterialWithoutIdMob" #searchMaterialWithoutIdMob required
                    placeholder="Izaberite materijal" />

                  <mat-autocomplete #autoMaterialWithoutIdMob="matAutocomplete" [displayWith]="displayFnWithoutId"
                    place>
                    <mat-option *ngFor="
                    let sub of (substances$ | async) | SearchMaterials: searchMaterialWithoutIdMob.value
                      " [value]="sub" (click)="getUnitOfMaterial(sub.dbid)">
                      {{ sub.Name }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-template>
              <div *ngIf="materialFC.invalid && clickAddMaterial" style="color: red; text-align: left;">
                Materijal je obavezno polje. <br>Popunite ga.
              </div>
            </form>
          </div>
          <!--
          <div class="form-group">
            <label for="jm">Jedinica mere</label>
            <select name="jm" id="jm" class="form-control" [(ngModel)]="selectedMaterial" #matUnit="ngModel" required>
              <option value="kg">kg</option>
              <option value="t">t</option>
              <option value="l">l</option>
            </select>
            <div *ngIf="matUnit.invalid && clickAddMaterial" style="color: red">
              Izaberite jedinicu mere.
            </div>
          </div>
          -->
          <div class="form-group">
            <label for="quantity">Planirana količina</label>
            <div class="input-group mb-3">
              <mat-form-field class="inputAuto">
                <input [(ngModel)]="quantityEntered" onKeyPress="if(this.value.length==7) return false;"
                  type="number" name="quantityEnter" placeholder="Unesite količinu" id="" matInput #quantity="ngModel" required />
                  <span matSuffix>{{unit}}</span>
              </mat-form-field>
              <div *ngIf="(quantityEntered == null || quantityEntered == undefined) && clickAddMaterial"
                style="color: red; text-align: left;">
                Planirana količina je obavezno polje.<br>Popunite ga.
              </div>
              <div
                *ngIf="(validMaterialQuantity == false && clickAddNewMaterial) || (validMaterialQuantity == false && clickAddMaterial)"
                style="color: red">
                Uneta količina mora biti veća od nule.
              </div>
              <div *ngIf="quantity.errors && clickAddNewMaterial" style="color: red">
                Uneta količina ne sme biti duža od 7 cifara.
              </div>
            </div>
          </div>
          <!--
          <div class="form-group">
            <label for="quantityPerHectar">Planirana količina / ha</label>
            <div class="input-group mb-3">
              <input [(ngModel)]="quantityEntered / crop.Area" type="number" name="quantityPerHectar"
                id="quantityPerHectar" class="form-control" readonly />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">/ha</span>
              </div>
            </div>
          </div>
          -->
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" style="background-color: #f68901">
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button *ngIf="!editMaterialMobFlag && new" type="button" class="btn btn-success" style="background-color: #33590b" (click)="addMaterial(materialModalMobForm.valid)">
          <i class="fa fa-save"></i> Dodaj 
        </button>
        <button *ngIf="!editMaterialMobFlag && !new" type="button" class="btn btn-success" style="background-color: #33590b" (click)="addNewMaterial()">
          <i class="fa fa-save"></i> Dodaj
        </button>
        <button *ngIf="editMaterialMobFlag && new" type="button" class="btn btn-success" style="background-color: #33590b" (click)="editExistingMaterial(materialMob)">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button *ngIf="editMaterialMobFlag && !new" type="button" class="btn btn-success" style="background-color: #33590b" (click)="updateMaterialBasicInfo(materialMob)">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Modal Worker/Machine -->
<div class="modal fade" id="workerMachineModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">
          <i class="fa fa-sticky-note-o"></i> Učinci radnika i mašina
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeButtonWowModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #workerModalForm="ngForm">
          <div class="row">
            <div class="col">
              <h5><i class="fa fa-user mr-2"></i> Radnik</h5>
              <h6 *ngIf="wow.id != undefined">{{ wow.user.Name }}</h6>
              <hr class="solid" />
              <div class="form-group">
                <label for="imePrz">Redovan rad</label>
                <div class="input-group mb-3">
                  <input [(ngModel)]="wow.dayPeriod" type="number" name="dayWP" class="form-control" id="dayWP"
                    onKeyPress="if(this.value.length==2) return false;" />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validDayPeriod == false && clickAddWowDetail) || (validDayPeriod == false && clickAddNewWow)"
                  style="color: red">
                  Maksimalan broj sati je 24, a minimalni 0.
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Noćni rad</label>
                <div class="input-group mb-3">
                  <input [(ngModel)]="wow.nightPeriod" type="number" name="nightWP" class="form-control" id="" max="24"
                    onKeyPress="if(this.value.length==2) return false;" />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validNightPeriod == false && clickAddWowDetail) || (validNightPeriod == false && clickAddNewWow)"
                  style="color: red">
                  Maksimalan broj sati je 24, a minimalni 0.
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Ukupan rad</label>
                <div class="input-group mb-3">
                  <input [(ngModel)]="wow.dayPeriod + wow.nightPeriod" type="number" name="sumHours"
                    class="form-control" id="" readonly max="24" />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validWorkPeriod == false && clickAddWowDetail) || (validWorkPeriod == false && clickAddNewWow)"
                  style="color: red">
                  Maksimalan broj sati je 24.
                </div>
              </div>
            </div>
            <div class="col" *ngIf="withoutMachine == false">
              <h5><i class="fa fa-truck mr-2"></i> Mašina</h5>
              <h6>{{ wow.machine.Name }}</h6>
              
              <hr class="solid" />
              
              <div class="form-group">
                <label for="imePrz">Početno stanje MČ</label>
                <div class="input-group mb-3">
                  <input [(ngModel)]="wow.initialState" type="number" name="initialState" class="form-control" id=""
                    onKeyPress="if(this.value.length==7) return false;" />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validInitialState == false && clickAddWowDetail) || (validInitialState == false && clickAddNewWow)"
                  style="color: red">
                  Početno stanje može biti nula ili veće od nule.
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Krajnje stanje MČ</label>
                <div class="input-group mb-3">
                  <input [(ngModel)]="wow.finalState" type="number" name="finalState" class="form-control" id=""
                    onKeyPress="if(this.value.length==7) return false;" />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
                <div
                  *ngIf="(validFinalState == false && clickAddWowDetail) || (validFinalState == false && clickAddNewWow)"
                  style="color: red">
                  Krajnje stanje može biti nula ili veće od nule i početnog stanja.
                </div>
              </div>
              <div class="form-group">
                <label for="imePrz">Utrošeno MČ</label>
                <div class="input-group mb-3">
                  <input [(ngModel)]="wow.finalState - wow.initialState" type="number" name="sumState"
                    class="form-control" id="" readonly />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">h</span>
                  </div>
                </div>
              </div>
              <div *ngIf="!foreignMachine" class="form-group">
                <label for="imePrz">Utrošeno goriva</label>
                <div class="input-group mb-3">
                  <input [(ngModel)]="wow.fuel" type="number" name="fuel" class="form-control" id=""
                    onKeyPress="if(this.value.length==7) return false;" />
                  <div class="input-group-append">
                    <span class="input-group-text" id="basic-addon2">l</span>
                  </div>
                </div>
                <div *ngIf="(validFuel == false && clickAddWowDetail) || (validFuel == false && clickAddNewWow)"
                  style="color: red">
                  Utrošak goriva može biti nula ili veći od nule.
                </div>
              </div>
              <p *ngIf="foreignMachine" style="color: #bd362f;">Gorivo knjižiti kroz MM transakciju</p>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button *ngIf="workOrder.status != 'Zatvoren' && creator==loggedUser" type="button" class="btn btn-danger"
          data-dismiss="modal" style="background-color: #f68901">
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button *ngIf="new && workOrder.status != 'Zatvoren' && creator==loggedUser" type="button"
          class="btn btn-success" style="background-color: #33590b" data-dismiss="modal">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button *ngIf="!new && !addNewWow && workOrder.status != 'Zatvoren' && creator==loggedUser" type="button"
          class="btn btn-success" style="background-color: #33590b" (click)="updateWow(wow)">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button *ngIf="!new && addNewWow && workOrder.status != 'Zatvoren' && creator==loggedUser" type="button"
          class="btn btn-success" style="background-color: #33590b" (click)="validDetailOfNewWow()">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
<!--Material modal-->
<div class="modal fade" id="materialModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel">
          <i class="fa fa-sticky-note-o"></i> Učinci materijala
        </h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeButtonMaterialModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #materialModalForm="ngForm">
          <h5><i class="fa fa-leaf mr-2"></i> Materijal</h5>
          <h6>{{ spentMaterial.material.Name }}</h6>
          <h6 *ngIf="spentMaterial.id != undefined">
            Planirana količina: {{ spentMaterial.quantity }}
            {{ spentMaterial.material.Unit }}
          </h6>
          <hr class="solid" />
          <div class="form-group">
            <label for="quantity">Utrošena količina</label>
            <div class="input-group mb-3">
              <input [(ngModel)]="spentMaterial.spent" type="number" name="quantity" id="quantity" class="form-control"
                #quantity="ngModel" required onKeyPress="if(this.value.length==7) return false;"
                (change)="calculateSpentPerHectar(spentMaterial.spent)" />
              <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2" *ngIf="new; else elseBlockSpentMaterialModal">{{ unit
                  }}</span>
                <ng-template #elseBlockSpentMaterialModal>
                  <span class="input-group-text" id="basic-addon2">{{
                    spentMaterial.material.Unit
                    }}</span>
                </ng-template>
              </div>
            </div>

            <div *ngIf="quantity.invalid && clickAddMaterial" style="color: red">
              Unesite količinu.
            </div>
            <div
              *ngIf="(validSpentQuantity == false && clickUpdateMaterial) || (validNewSpentQuantity == false && clickSaveNewModalMaterial)"
              style="color: red">
              Uneta količina mora biti veća od nule.
            </div>
          </div>
          <div class="form-group">
            <label for="quantityPerHectar">Utrošena količina po ha</label>
            <div class="input-group mb-3">
              <input *ngIf="new; else elseBlockSpentPerHectar" [(ngModel)]="spentMaterial.spent / crop.Area"
                type="number" name="quantityPerHectar" id="quantityPerHectar" class="form-control" readonly />
              <div class="input-group-append" *ngIf="new">
                <span class="input-group-text" id="basic-addon2">{{ unit }}/ha</span>
              </div>
              <ng-template #elseBlockSpentPerHectar>

                <input [(ngModel)]="spentMaterial.spent/workOrder.treated" type="number" name="spentPerHectar" id=""
                  class="form-control" readonly />
                <div class="input-group-append">
                  <span class="input-group-text" id="basic-addon2">{{ spentMaterial.material.Unit }}/ha</span>
                </div>
              </ng-template>
            </div>
          </div>
          <div class="form-group">
            <label>Jedinica mere</label>
            <div class="input-group mb-3">
              <input *ngIf="new; else elseBlcokUnit" [(ngModel)]="unit" type="text" name="jm" id="" class="form-control"
                readonly />
              <ng-template #elseBlcokUnit>
                <input [(ngModel)]="spentMaterial.material.Unit" type="text" name="jm" id="" class="form-control"
                  readonly />
              </ng-template>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button *ngIf="workOrder.status != 'Zatvoren' && creator==loggedUser" type="button" class="btn btn-danger"
          data-dismiss="modal" style="background-color: #f68901">
          <i class="fa fa-window-close"></i> Odustani
        </button>
        <button *ngIf="new && workOrder.status != 'Zatvoren' && creator==loggedUser" type="button"
          class="btn btn-success" style="background-color: #33590b" data-dismiss="modal">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button *ngIf="!new && !addNewSpentMaterial && workOrder.status != 'Zatvoren' && creator==loggedUser"
          type="button" class="btn btn-success" style="background-color: #33590b"
          (click)="updateMaterial(spentMaterial)">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
        <button *ngIf="!new && addNewSpentMaterial && workOrder.status != 'Zatvoren' && creator==loggedUser"
          type="button" class="btn btn-success" style="background-color: #33590b" (click)="validSpentMaterial()">
          <i class="fa fa-save"></i> Sačuvaj
        </button>
      </div>
    </div>
  </div>
</div>
<!--Modal error messages-->
<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true" id="errorsModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Greške</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <button hidden type="button" class="close" data-toggle="modal" data-target="#errorsModal" #openErrorsModal>
        </button>
      </div>
      <div class="modal-body">
        <ul>
          <li *ngFor="let err of errors">{{err}}</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" style="background-color: #ffc803; color: white; border:none">
          <i class="fa fa-window-close"></i> Zatvori
        </button>
      </div>
    </div>
  </div>
</div>
<!--Modal zatvaranje radnog naloga-->
<div class="modal fade" id="closeWOModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Potrvda zatvaranja RN i knjiženja materijala
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeButtonCloseWOModal>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h6>Datum otvaranaj RN: {{dateOfCreateWO}}</h6>
        <h6>Datum knjiženja RN: {{dateOfCreateWO}}</h6>
        <h6>Datum zatvaranja RN: {{today | date:'dd.MM.yyyy.'}}</h6>
        <p *ngIf="foreignMachine" style="color: #bd362f;">Gorivo knjižiti kroz MM transakciju</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-delete mr-2" data-dismiss="modal"><i
            class="fa fa-window-close"></i> Odustani</button>
        <button class="btn btn-primary btn-add" (click)="closeWorkOrder()">
          <i class="fa fa-check"></i> Potrvdi
        </button>
      </div>
    </div>
  </div>
</div>
<!--Modal upozorenje pre brisanje radnika-->
<div class="modal fade" id="deleteWorkerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Da li ste sigurni da želite da obrišete radnika i mašinu?
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-delete mr-2" data-dismiss="modal"><i
            class="fa fa-window-close"></i> Odustani</button>
        <button class="btn btn-primary btn-add" data-dismiss="modal"
          (click)="deleteExistingWorkOrderWorker(workOrderWorkerId)">
          <i class="fa fa-check"></i> Potrvdi
        </button>
      </div>
    </div>
  </div>
</div>
<!--Modal upozorenje pre brisanje materijala-->
<div class="modal fade" id="deleteMaterialModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Da li ste sigurni da želite da obrišete materijal?
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-delete mr-2" data-dismiss="modal"><i
            class="fa fa-window-close"></i> Odustani</button>
        <button class="btn btn-primary btn-add" data-dismiss="modal" (click)="deleteExistingSpentMaterial(materialId)">
          <i class="fa fa-check"></i> Potrvdi
        </button>
      </div>
    </div>
  </div>
</div>
<!--Modal cuvanje zapocetog dodavanja izvrsioca/masine-->
<div class="modal fade" id="saveStartedCreationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Potvrda započetih dodavanja
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeSaveStartedModal>
          <span aria-hidden="true">&times;</span>
        </button>
        <button hidden type="button" class="close" data-toggle="modal" data-target="#saveStartedCreationModal" #saveStartedCreation>
          <span hidden aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-borderless">
          <tr *ngIf="startedCreationWorker">
            <td style="vertical-align: middle;">
              <h6>Da li želite da dodate {{workerFC.value.name}} u izvršioce?</h6>
            </td>
            <td>
              <label>
                <input type="radio" name="worker" value="workerYes" (change)="getAnswerWorker($event.target.value)"/>
                <span class="btn btn-primary btn-yes mr-2">Da</span>
              </label>
            </td>
            <td>
              <label>
                <input type="radio" name="worker" value="workerNo" (change)="getAnswerWorker($event.target.value)"/>
                <span class="btn btn-primary btn-no mr-2">Ne</span>
              </label>
            </td>
          </tr>
          <tr *ngIf="startedCreationMaterial">
            <td style="vertical-align: middle;">
              <h6>Da li želite da dodate {{materialFC.value.name}} u materijale?</h6>
            </td>
            <td>
              <label>
                <input type="radio" name="material" value="materialYes" (change)="getAnswerMaterial($event.target.value)"/>
                <span class="btn btn-primary btn-yes mr-2">Da</span>
              </label>
            </td>
            <td>
              <label>
                <input type="radio" name="material" value="materialNo" (change)="getAnswerMaterial($event.target.value)"/>
                <span class="btn btn-primary btn-no mr-2">Ne</span>
              </label>
            </td>
          </tr>
        </table>
        <div>
          <p *ngIf="errWow" style="color: red;">{{msgInvalidAnswerWow}}</p>
          <br>
          <p *ngIf="errMat" style="color: red;">{{msgInvalidAnswerMat}}</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-delete mr-2" data-dismiss="modal">
          <i class="fa fa-window-close"></i> Odustani</button>
        <button class="btn btn-primary btn-add" (click)="addWorkerAndUpdateWo()">
          <i class="fa fa-check"></i> Potvrdi
        </button>
      </div>
    </div>
  </div>
</div>
<!--Modal potvrda pre storniranja naloga-->
<div class="modal fade" id="cancellationWorkOrderModal" tabindex="-1" role="dialog" 
  aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Da li ste sigurni da želite da stornirate radni nalog?
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table table-borderless">
          <tr>
            <th><i class="fa fa-slack mr-2"></i>Broj radnog naloga:</th>
            <td>{{workOrder.sapId}}</td>
          </tr>
          <tr>
            <th><i class="fa fa-calendar mr-2"></i>Datum:</th>
            <td>{{dateOfCreateWO}}</td>
          </tr>
          <tr>
            <th><i class="fa fa-map-marker mr-2"></i>Parcela:</th>
            <td>{{workOrder.table}}</td>
          </tr>
          <tr>
            <th><i class="fa fa-cubes mr-2"></i>Usev:</th>
            <td>{{workOrder.cropName}}</td>
          </tr>
          <tr>
            <th><i class="fa fa-file mr-2"></i>ATM:</th>
            <td>{{workOrder.operationName}}</td>
          </tr>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary btn-delete mr-2" data-dismiss="modal"><i
            class="fa fa-window-close"></i> Odustani</button>
        <button class="btn btn-primary btn-add" data-dismiss="modal" (click)="cancellationWorkOrder()">
          <i class="fa fa-check"></i> Potrvdi
        </button>
      </div>
    </div>
  </div>
</div>